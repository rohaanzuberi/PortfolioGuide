(this["webpackJsonp@dcmfe/mfe-app-workspace"]=this["webpackJsonp@dcmfe/mfe-app-workspace"]||[]).push([[91],{"./src/workspace/Workspace.tsx":function(e,t,n){"use strict";n.r(t);var a,r=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=n("../../libs/shared/domain/dist/es/unreachable.js"),c=n("../../libs/shared/domain/dist/es/types/ExactRecord.js"),s=n("../../libs/shared/domain/dist/es/types/Optional.js"),i=n("../../node_modules/io-ts-types/es6/BooleanFromString.js"),l=n("../../node_modules/@datacamp/mfe-util-sentry/dist/esm/index.js"),u=n("../../node_modules/@datacamp/waffles/esm/paragraph/paragraph.js"),d=n("../../node_modules/@datacamp/waffles/esm/tokens/tokens.js"),b=n("../../node_modules/@datacamp/waffles-text/es/components/Heading.js"),p=n("../../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),f=n("../../node_modules/fp-ts/es6/index.js"),m=n("react"),h=n("../../node_modules/react-router/esm/react-router.js"),j=n("./src/accountSelector/groupsSelector.ts"),g=n("./src/accountSelector/useAccountSelector.tsx"),O=n("./src/createWorkspace/useCreateWorkspace.tsx"),w=n("./src/editor/index.tsx"),v=n("./src/editor/EditorProvider.tsx"),k=n("../../node_modules/@datacamp/waffles-button/es/index.js"),y=n("react-dom"),x=n("./src/accessControl/useRoleAssignmentConfig.tsx"),S=n("./src/elementIds.ts"),C=n("../../node_modules/@datacamp/waffles/esm/icon/cross.js"),I=n("../../node_modules/@datacamp/waffles-text/es/components/CodeBlock.js"),T=n("../../node_modules/react-use/esm/useWindowSize.js"),_=n("./src/styles.ts"),E=n("../../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js"),P=function(e){var t=e.logs,n=e.setShowingLogs,a=Object(T.a)().width,r=a<=_.h;return Object(E.c)("div",{css:{background:d.a.colors.white,boxShadow:d.a.boxShadow.thick,display:"flex",flexDirection:"column",height:"100%",left:r?0:_.e,marginBottom:"0px",overflow:"hidden",position:"absolute",width:r?_.e:Math.min(584,a-_.f-_.e)},children:[Object(E.c)("div",{css:{alignItems:"center",display:"flex",justifyContent:"space-between",margin:d.a.spacing.medium,marginBottom:7},children:[Object(E.b)(b.a,{as:"h2",css:{flex:"0 0 auto",fontSize:d.a.fontSizes.medium},size:650,children:"Last publication logs"}),Object(E.b)(k.g,{ariaLabel:"close logs",css:[_.t,{display:"flex",padding:10}],onClick:function(){return n(!1)},children:Object(E.b)(C.a,{})})]}),Object(E.b)(I.a,{css:{code:{color:d.a.colors.redDark},height:"100%",margin:d.a.spacing.medium,marginTop:"0 !important",overflow:"scroll",padding:d.a.spacing.medium},children:null==t?"No logs\u2026":t.lines.map((function(e){return"[".concat(e.level,"] ").concat(e.message)})).join("\n")})]})},z=n("../../node_modules/@datacamp/waffles-toast/es/index.js"),L=n("../../node_modules/react-use/esm/useUpdateEffect.js"),A=n("../../node_modules/@datacamp/waffles/esm/icon/external-link.js"),R=n("../../node_modules/@datacamp/waffles/esm/screen-reader-only/screen-reader-only.js"),D=n("../../node_modules/@datacamp/waffles-utils/es/index.js"),W=n("./src/ButtonLink.tsx"),M=n("./src/tracking/index.tsx"),N=function(){return Object(E.c)("div",{css:{color:d.a.colors.navySubtleTextOnLight,fontSize:d.a.fontSizes.small,lineHeight:d.a.lineHeights.relaxed,marginTop:d.a.spacing.small},children:["Runs your notebook from top to bottom. Additional package installs need to happen inside the notebook.",Object(E.b)(W.a,{appearance:"default",css:{":active, :focus, :focus:hover, :hover":{"&:after":{border:"none"},backgroundColor:Object(D.d)(d.a.colors.navy,d.a.opacity.low)},backgroundColor:"transparent",borderWidth:0,height:18,padding:"0px 2px",span:{alignItems:"center",color:d.a.colors.navySubtleTextOnLight,display:"inline-flex",fontSize:d.a.fontSizes.small,marginRight:d.a.spacing.xsmall},svg:{height:12,marginLeft:d.a.spacing.xsmall,path:{fill:d.a.colors.navySubtleTextOnLight},width:12},textTransform:"none"},href:"https://workspace-docs.datacamp.com/publish/publications",size:"small",useLinkClickOptions:{dataTrackId:Object(M.c)("publications-doc"),forceOpenInNewWindow:!0},children:Object(E.c)("span",{css:{fontWeight:d.a.fontWeights.bold},children:["More info ",Object(E.b)(A.a,{color:d.a.colors.navySubtleTextOnDark}),Object(E.b)(R.a,{children:"open in new tab"})]})})]})},F=n("./src/modal/modalActions.ts"),U=n("./src/reducer.ts"),J=function(e){return new Intl.DateTimeFormat("en-US",{day:"numeric",hour:"numeric",minute:"numeric",month:"short"}).format(e)},B=function(e){var t=e.children,n=e.className,a=e.onClick;return Object(E.b)(k.g,{className:n,css:{":active, :focus, :focus:hover, :hover":{"&:after":{border:"none"},backgroundColor:Object(D.d)(d.a.colors.navy,d.a.opacity.low),span:{textDecoration:"underline"}},border:"none",padding:"0px 2px",span:{color:d.a.colors.navySubtleTextOnLight,fontSize:d.a.fontSizes.medium,fontWeight:d.a.fontWeights.bold,lineHeight:"21px"},textTransform:"none"},onClick:a,size:"small",children:t})},V=function(e){return null!=e&&["cancelled","cancelled-by-next-publication","failed-to-start","failed-too-large","failed","timedOut"].includes(e.status)},q=function(e){var t=e.publication,n=e.setShowingLogs,a=e.showingLogs,r=Object(U.b)();switch(null===t||void 0===t?void 0:t.status){case"cancelled":case"cancelled-by-next-publication":return Object(E.c)(u.a,{css:{color:d.a.colors.redDarkText},children:["Publication cancelled on"," ",Object(E.b)("strong",{css:{color:d.a.colors.redDarkText},children:J(t.createdAt)})]});case"failed-to-start":return Object(E.b)(u.a,{css:{color:d.a.colors.redDarkText},children:"The last publication failed to start. Please try to publish again later."});case"failed-too-large":return Object(E.c)("div",{css:{display:"flex"},children:[Object(E.b)(u.a,{css:{color:d.a.colors.redDarkText},children:"The last publication was too large, view logs for more info."}),Object(E.b)(B,{onClick:function(){return n((function(e){return!e}))},children:"".concat(a?"Hide":"View"," logs")})]});case"failed":return Object(E.c)(E.a,{children:[Object(E.c)("div",{css:{color:d.a.colors.redDarkText},children:["Publication failed on"," ",Object(E.b)("strong",{css:{color:d.a.colors.redDarkText},children:J(t.finishedAt)})]}),Object(E.c)("div",{css:{borderBottom:"".concat(d.a.borderWidth.thin," solid ").concat(d.a.colors.greyMedium),display:"flex",gap:d.a.spacing.xsmall,marginBottom:d.a.spacing.medium,marginTop:d.a.spacing.xsmall,paddingBottom:d.a.spacing.medium},children:[Object(E.b)(B,{onClick:function(){return n((function(e){return!e}))},children:"".concat(a?"Hide":"View"," logs")}),Object(E.b)(B,{onClick:function(){r(Object(F.e)({publicationId:t.id}))},children:"View publication"})]})]});case"timedOut":return Object(E.b)(u.a,{css:{color:d.a.colors.redDarkText},children:"The last publication took too long to finish running."});default:return Object(o.c)(t,null)}},H=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),G=n("../../libs/api-ts-client/dist/es/index.js"),K=n("./src/api/collabApi.ts"),Y=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),Q={backgroundColor:d.a.colors.greenDark,borderRadius:4,transition:"width 300ms"},X={backgroundColor:d.a.colors.grey,borderRadius:4},Z=function(e){var t=e.className,n=e.percentage,a=void 0===n?0:n;return Object(E.c)("progress",{className:t,css:Object(Y.a)({"&::-moz-progress-bar":Q,"&::-webkit-progress-bar":X,"&::-webkit-progress-value":Q,appearance:"none",border:"none",height:8,width:"100%"},X),max:100,value:a,children:["Progress: ",a,"%"]})},$=n("./src/util/useAsyncEitherFn.ts"),ee=n("../../libs/shared/domain/dist/es/validation/decodeOrThrow.js"),te=n("../../node_modules/io-ts/es6/index.js"),ne=te.i(te.r,(function(e){return e>=0&&e<=100}),"Percentage"),ae=Object(ee.a)(ne),re=function(e){var t=e.publicationExists,n=e.publicationId,a=e.publicationProgress,c=Object($.c)((function(){return K.a.publication.cancel({params:{publicationId:n}})}),[n]),s=Object(r.a)(c,2),i=s[0],l=s[1];Object(m.useEffect)((function(){if("ready"===i.type&&f.b.isLeft(i.value))switch(i.value.left.errorType){case"notFinished":case"notFoundError":case G.a:Object(z.b)({intent:"error",title:"Something went wrong when cancelling your publication, please retry."});break;default:throw Object(o.b)(i.value.left)}}),[i]);var u=function(e){if(null==e)return ae(0);var t=e.completedCellCount,n=e.totalCellCount;return ae(0===n?100:t/n*100)}(a),b=Math.floor(u),p=Object(m.useState)((function(){var e=Math.random();return e<.25?"Publishing your data masterpiece\u2026":e<.5?"Publishing your data artwork\u2026":e<.75?"Publishing your brainchild\u2026":"Publishing your workspace\u2026"})),h=Object(r.a)(p,2),j=h[0],g=h[1];Object(m.useEffect)((function(){var e=window.setTimeout((function(){return g("Magic\u2019s almost ready\u2026")}),5e3);return function(){return window.clearTimeout(e)}}),[]);var O=Object(T.a)().width<=_.h?"medium":"small";return Object(E.c)(E.a,{children:[Object(E.b)("div",{css:{fontWeight:d.a.fontWeights.bold,marginBottom:d.a.spacing.small},children:t?"Updating your publication\u2026":j}),Object(E.b)(Z,{percentage:u}),Object(E.c)("div",{css:{alignItems:"center",display:"flex",justifyContent:"space-between",marginTop:d.a.spacing.xsmall,width:"100%"},children:[Object(E.c)("span",{children:[b,"%"," ",null!=a&&Object(E.c)("span",{css:{color:d.a.colors.greyDark},children:["(",a.completedCellCount,"/",a.totalCellCount," cells)"]})]}),Object(E.b)(k.g,{ariaLabel:"cancel publication",css:Object(H.a)({border:"none",padding:0,span:{color:d.a.colors.blueDarkText,fontWeight:d.a.fontWeights.bold,lineHeight:d.a.lineHeights.default}},_.r.smartphone,{height:d.a.sizing.large}),disabled:Object($.b)(i),onClick:l,size:O,children:"Cancel"})]})]})},oe=n("../../node_modules/@datacamp/waffles/esm/icon/link.js"),ce=n("../../node_modules/@datacamp/waffles/esm/text/text.js"),se=n("../../node_modules/@datacamp/waffles-form-elements/es/Switch/index.js"),ie=n("../../node_modules/copy-to-clipboard/index.js"),le=n.n(ie),ue=n("./src/accessControl/useAccessControl.ts"),de=n("./src/publicationView/useWorkspaceLinks.tsx"),be=n("./src/util/useTooltip.tsx"),pe=n("./src/workspace/workspaceAction.ts"),fe=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator/index.js"),me=n.n(fe),he=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),je=function(e){var t=e.publication,n=e.workspace,a=Object(ue.a)({type:"workspace",workspaceId:n.id}).roleAssignments,o=Object(de.a)({workspaceId:n.id}).publicationUrl,c=Object(m.useCallback)((function(){le()(o),Object(z.b)({intent:"success",title:"Link copied to clipboard"})}),[o]),s=n.id,i=!Object(m.useMemo)((function(){return"succeeded"===(null===a||void 0===a?void 0:a.status)&&a.data.some((function(e){return"workspace"===e.resource.type&&e.resource.workspaceId===s&&"public"===e.subject.type}))}),[a,s]),l=Object(U.b)(),b=function(e){var t=e.featured,n=e.setFeatured,a=e.workspaceId,o=Object(x.c)().isPublished,c=Object($.c)(Object(he.a)(me.a.mark((function e(){return me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f.c,e.next=3,K.a.workspace.setFeatured({body:{featured:!t},params:{id:a}});case 3:e.t1=e.sent,e.t2=f.b.fold((function(){Object(z.b)({intent:"error",title:"Something went wrong. If the problem persists, please report an issue."})}),(function(e){n(e.featured),e.featured?Object(z.b)({description:o?void 0:x.b,intent:"success",title:"Added to your profile"}):Object(z.b)({intent:"success",title:"Removed from profile"})})),e.t0.pipe.call(e.t0,e.t1,e.t2);case 6:case"end":return e.stop()}}),e)}))),[t,a,n,o]),s=Object(r.a)(c,2),i=s[0];return{featurePublication:s[1],isLoading:Object($.b)(i)}}({featured:n.featured,setFeatured:function(e){return l(Object(pe.b)(e))},workspaceId:s}),p=b.featurePublication,h=b.isLoading,j=Object(be.a)(),g=j.Tooltip,O=j.tooltipParentProps;return Object(E.c)(E.a,{children:[Object(E.c)(u.a,{children:["Last published on ",Object(E.b)("strong",{children:J(t.createdAt)})]}),Object(E.c)("div",{css:{display:"flex",gap:d.a.spacing.small,justifyContent:"stretch",marginBottom:d.a.spacing.medium,marginTop:d.a.spacing.xsmall,position:"relative",zIndex:2},children:[Object(E.b)(W.a,{css:Object(H.a)({flexGrow:1,textTransform:"none"},_.r.smartphone,{height:d.a.sizing.large}),href:o,useLinkClickOptions:{forceOpenInNewWindow:!0},children:"Open live publication"}),Object(E.b)(k.g,{ariaLabel:"copy publication link",css:Object(H.a)({},_.r.smartphone,{height:d.a.sizing.large,width:d.a.sizing.large}),intent:"neutral",onClick:c,size:"small",tooltipAppearance:"dark",tooltipPosition:"bottomRight",tooltipText:"Copy link",children:Object(E.b)(oe.a,{})})]}),n.featureable&&Object(E.c)(E.a,{children:[Object(E.b)("div",Object(Y.a)(Object(Y.a)({},O),{},{children:Object(E.b)(se.a,{checked:!i&&n.featured,css:{fontSize:d.a.fontSizes.medium},disabled:i||h,fullWidth:!0,onChange:p,children:Object(E.c)(ce.a,{css:{color:d.a.colors.navySubtleTextOnLight},children:["Feature publication on my profile"," "]})})})),i&&Object(E.c)(g,{css:{maxWidth:230,whiteSpace:"normal"},position:"bottomLeft",children:[Object(E.b)(ce.a,{css:{color:d.a.colors.white},children:"You can only feature publications when a workspace is public."}),Object(E.b)("br",{}),Object(E.b)(ce.a,{css:{color:d.a.colors.navySubtleTextOnDark},children:"You can change this in the sharing settings of this workspace."})]})]}),Object(E.b)("hr",{css:{border:"solid ".concat(Object(D.d)(d.a.colors.navy,d.a.opacity.low)),borderWidth:"".concat(d.a.borderWidth.thin," 0 0 0"),margin:"".concat(d.a.spacing.medium," 0")}})]})},ge=n("../../node_modules/@datacamp/waffles-form-elements/es/Select/index.js"),Oe=n("../../node_modules/@datacamp/waffles-form-elements/es/Select/Option.js"),we=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),ve=n("./src/multiplexer/MultiplexerSessionContext.ts"),ke=function(e){return"publishable_files"===e.type},ye=function(){},xe=Object(p.c)({border:"".concat(d.a.borderWidth.thin," solid ").concat(d.a.colors.greyDark),boxShadow:"none",fontSize:d.a.fontSizes.medium}),Se=function(e){var t=e.onChange,n=Object(m.useState)(void 0),a=Object(r.a)(n,2),o=a[0],c=a[1],s=function(){var e=Object(ve.c)(),t=e.multiplexerSessionManager,n=e.outputs;Object(m.useEffect)((function(){var e;null===t||void 0===t||null===(e=t.remoteSession)||void 0===e||e.list_publishable_files()}),[t]);var a=Object(m.useMemo)((function(){var e=Object(we.a)(n).reverse().find(ke);return null==e?null:Object(we.a)(e.payload).sort()}),[n]);return null==a?{isLoading:!0}:{isLoading:!1,workspaceFiles:a}}();Object(m.useEffect)((function(){!s.isLoading&&s.workspaceFiles.length>0&&null!=s.workspaceFiles[0]&&null==o&&t(s.workspaceFiles[0])}),[s,o,t]);var i=Object(T.a)().width<=_.h?"medium":"small";if(s.isLoading)return Object(E.b)(ge.a,{css:xe,disabled:!0,name:"loading-files-to-publish",onChange:ye,size:i,value:"loading",children:[Object(E.b)(Oe.a,{value:"loading",children:"Loading files\u2026"},"loading")]});var l=s.workspaceFiles;return 0===l.length||null==l[0]?Object(E.b)(ge.a,{css:xe,disabled:!0,name:"no-files-to-publish",onChange:ye,size:i,value:"no-file",children:[Object(E.b)(Oe.a,{value:"no-files",children:"No publishable files in your workspace"},"no-files")]}):Object(E.b)(ge.a,{css:xe,name:"notebook-to-publish",onChange:function(e){c(e),t(e)},size:i,value:null!==o&&void 0!==o?o:l[0],children:l.map((function(e){return Object(E.b)(Oe.a,{value:e,children:e},e)}))})},Ce=n("./src/workspace/workspaceSelector.ts"),Ie=function(e){var t=e.selectedFile,n=e.startSessionJwt,a=Object(U.c)(Ce.c),c=Object(ve.c)(),s=c.multiplexerSessionManager,i=c.source,l=null===a||void 0===a?void 0:a.id,u=Object(m.useState)(),d=Object(r.a)(u,2),b=d[0],p=d[1],h=function(e){switch(e._tag){case"rdocs":case"github":case"project":case"integration":case"workspace":return!0;case"template":var t,n;return!["dc-data-science-python","dc-data-science-r"].includes(null!==(t=null===(n=e.template)||void 0===n?void 0:n.key)&&void 0!==t?t:"");default:return Object(o.b)(e)}}(i),j=null===s||void 0===s?void 0:s.image,g=Object($.c)(Object(he.a)(me.a.mark((function e(){var n;return me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=l&&null!=t){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,K.a.publication.create({body:{fileName:t,image:j,runHeadless:h,workspaceId:l}});case 4:return n=e.sent,p(n),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)}))),[t,l,h,j]),O=Object(r.a)(g,2),w=O[0],v=O[1];return Object(m.useEffect)((function(){var e;if(null!=b&&null!=t&&null!=n)if(f.b.isLeft(b))Object(z.b)({intent:"error",title:"Something wrong happened when creating your publication, please retry."});else if(!h){var a=b.right,r=a.publicationId,o=a.publicationJwt;null!=s?null===(e=s.remoteSession)||void 0===e||e.publish_notebook({publication:{id:r,jwt:o},relative_notebook_path:t,start_session_jwt:n}):Object(z.b)({intent:"error",title:"Please restart your session to publish your workspace."})}}),[b,t,s,h,n]),{onPublish:v,publishState:w}},Te=function(e){var t=e.className,n=e.lastPublication,a=e.publicationExists,c=e.startSessionJwt,s=Object(m.useState)(),i=Object(r.a)(s,2),l=i[0],b=i[1],p=Ie({selectedFile:l,startSessionJwt:c}),f=p.onPublish,h=p.publishState,j=function(e){var t=e.lastPublication,n=e.loading,a=e.publicationExists,r=e.selectedFile,c=e.startSessionJwt;if(n)return{callToAction:"Starting\u2026",disabled:!0};var s=a?"Update":"Publish",i=a?{trackid:Object(M.c)("update-publication")}:{trackid:Object(M.c)("publish-workspace")};if(null==r||null==c)return{callToAction:s,disabled:!0};var l=null===t||void 0===t?void 0:t.status;switch(l){case"created":return{callToAction:"Starting\u2026",disabled:!0};case"generating":return{callToAction:"Running\u2026",disabled:!0};case"failed":case"failed-too-large":case"failed-to-start":case"timedOut":case"cancelled":case"cancelled-by-next-publication":case"succeeded":case void 0:return{callToAction:s,dataAttributes:i,disabled:!1};default:return Object(o.c)(l,{callToAction:s,dataAttributes:i,disabled:!1})}}({lastPublication:n,loading:Object($.b)(h),publicationExists:a,selectedFile:l,startSessionJwt:c}),g=j.callToAction,O=j.dataAttributes,w=j.disabled;return Object(E.c)(E.a,{children:[Object(E.b)(u.a,{css:{fontWeight:d.a.fontWeights.bold},children:a?"Update your publication":"Not published yet"}),Object(E.c)("div",{className:t,css:{display:"flex"},children:[Object(E.b)("div",{css:{flexGrow:1,marginRight:d.a.spacing.small},children:Object(E.b)(Se,{onChange:b})}),Object(E.b)(k.g,{appearance:"primary",css:Object(H.a)({},_.r.smartphone,{height:d.a.sizing.large}),dataAttributes:O,disabled:w,intent:"success",onClick:f,size:"small",children:g})]})]})},_e=function(e){var t=e.publicationExists,n=e.setShowingLogs,a=e.showingLogs,c=e.startSessionJwt,s=e.workspace,i=e.workspacePublicationStatus,l=i.lastPublication,u=i.lastSucceededPublication;Object(L.a)((function(){"succeeded"===(null===l||void 0===l?void 0:l.status)&&Object(z.b)({description:"Wow, that\u2019s a piece of art!",intent:"success",title:"Tada! Publishing completed"})}),[null===l||void 0===l?void 0:l.status]);var d=Object(m.useState)(V(l)?l:void 0),b=Object(r.a)(d,2),p=b[0],f=b[1];switch(Object(m.useEffect)((function(){var e;V(l)?f(l):null==l||null!=(e=l)&&["created","generating"].includes(e.status)||f(void 0)}),[l]),null===l||void 0===l?void 0:l.status){case"created":case"generating":return Object(E.c)(E.a,{children:[null!=p&&Object(E.b)(q,{publication:p,setShowingLogs:n,showingLogs:a}),null!=u&&Object(E.b)(je,{publication:u,workspace:s}),Object(E.b)(re,{publicationExists:t,publicationId:l.id,publicationProgress:l.progress})]});case"succeeded":return Object(E.c)(E.a,{children:[Object(E.b)(je,{publication:l,workspace:s}),Object(E.b)(Te,{lastPublication:i.lastPublication,publicationExists:t,startSessionJwt:c}),Object(E.b)(N,{})]});case"cancelled":case"cancelled-by-next-publication":case"failed-to-start":case"failed-too-large":case"failed":case"timedOut":return Object(E.c)(E.a,{children:[Object(E.b)(q,{publication:l,setShowingLogs:n,showingLogs:a}),null!=u&&Object(E.b)(je,{publication:u,workspace:s}),Object(E.b)(Te,{lastPublication:i.lastPublication,publicationExists:t,startSessionJwt:c}),Object(E.b)(N,{})]});default:return Object(o.a)(null)(l,Object(E.c)(E.a,{children:[Object(E.b)(Te,{lastPublication:i.lastPublication,publicationExists:t,startSessionJwt:c}),Object(E.b)(N,{})]}))}},Ee=n("../../libs/shared/domain/dist/es/domains/publication/domain.js"),Pe=n("../../node_modules/io-ts/lib/PathReporter.js"),ze=n("../../node_modules/react-use/esm/useAsyncRetry.js"),Le=n("./src/sentry.ts"),Ae=n("../../node_modules/socket.io-client/build/esm/index.js"),Re=n("./src/config.ts"),De=Object(Ae.a)(Re.a.urls.collabApi,{autoConnect:!1,transports:["websocket"]}),We=n("../../node_modules/react/jsx-runtime.js"),Me=Object(m.createContext)(void 0),Ne=function(e){var t=e.children,n=Object(m.useState)(0),a=Object(r.a)(n,2),o=a[0],c=a[1],s=Object(m.useState)("loading"),i=Object(r.a)(s,2),l=i[0],u=i[1];return Object(m.useEffect)((function(){u("loading");var e=function(){return u("connected")},t=function(){return u("loading")},n=function(){u("error"),setTimeout((function(){return c((function(e){return e+1}))}),500)};return De.on("connect",e),De.on("disconnect",t),De.on("error",n),De.connect(),function(){De.off("connect",e),De.off("disconnect",t),De.off("error",n),De.disconnect()}}),[o]),Object(We.jsx)(Me.Provider,{value:{socket:De,status:l},children:t})},Fe=function(){var e=Object(m.useContext)(Me);if(null==e)throw new Error("Missing Collab Socket Provider");return e},Ue=function(e,t){var n=t.find((function(e){return"succeeded"===e.status}));return null!=n?n:null===e||void 0===e?void 0:e.lastSucceededPublication},Je=function(e){var t=e.workspaceId,n=Fe(),a=Object(m.useState)(),o=Object(r.a)(a,2),c=o[0],s=o[1],i=Object(m.useState)([]),l=Object(r.a)(i,2),u=l[0],d=l[1],b=Object(m.useState)("loading"),p=Object(r.a)(b,2),h=p[0],j=p[1],g=Object(ze.a)((function(){return K.a.workspacePublication.getPublicationStatus({params:{workspaceId:t}})}),[t]),O=Object(m.useMemo)((function(){return g.loading||void 0===g.value?null:function(e,t,n){var a=t.find((function(e){var t=e.id;return null==n||n.id===t}));return null==a?null==n?e:Object(Y.a)(Object(Y.a)({},e),{},{lastPublication:n}):{lastPublication:a,lastSucceededPublication:Ue(e,t)}}(g.value,u,c)}),[u,c,g]);return Object(m.useEffect)((function(){g.loading&&j("loading"),null!=g.error&&j("failed"),void 0!==g.value&&j("succeeded")}),[g]),Object(m.useEffect)((function(){"connected"===n.status&&n.socket.emit("joinWorkspacePublicationUpdates",{workspaceId:t})}),[n.status,n.socket,t]),Object(m.useEffect)((function(){var e=function(e){var t=Ee.d.decode(e);if(f.h.isRight(t)){var n=t.right;"created"!==n.status&&d((function(e){return[n].concat(Object(we.a)(e))}))}else Le.b.captureMessage("Could not decode publication from websocket: ".concat(Pe.PathReporter.report(t)))},t=function(e){return s(e)},a=function(){return j("failed")};return n.socket.on("publicationUpdate",e),n.socket.on("publicationCreate",t),n.socket.on("exception",a),function(){n.socket.off("publicationUpdate",e),n.socket.off("publicationCreate",t),n.socket.off("exception",a)}}),[n.socket]),{retry:g.retry,status:h,workspacePublicationStatus:O}},Be=n("./src/Spinner.tsx"),Ve=n("./src/workspace/ErrorMessage.tsx"),qe=n("./src/workspace/restartWorkspaceSession.tsx"),He=n("./src/workspace/workspaceLayoutSelector.ts"),Ge=n("../../node_modules/@datacamp/waffles/esm/icon/share.js"),Ke=n("../../node_modules/@datacamp/waffles/esm/icon/chevron-right.js"),Ye=function(e){var t=e.workspace,n=Object(U.b)();return Object(E.c)(k.g,{css:[_.k,{":hover":{borderColor:d.a.colors.blueDarkText},":hover, :active, :focus":{background:d.a.colors.white},alignItems:"center",borderLeft:"".concat(d.a.borderWidth.xthick," solid ").concat(d.a.colors.blueDarkText),borderRadius:d.a.borderRadius.medium,boxShadow:d.a.boxShadow.thin,display:"flex",justifyContent:"space-between",lineHeight:d.a.lineHeights.relaxed,padding:d.a.spacing.medium,textTransform:"none"}],onClick:function(){return n(Object(F.h)({published:!0,workspace:t}))},children:[Object(E.c)("span",{css:{alignItems:"center",display:"flex"},children:[Object(E.b)(Ge.a,{css:{color:d.a.colors.navySubtleTextOnLight,marginRight:d.a.spacing.small}}),Object(E.c)("span",{children:["Open"," ",Object(E.b)("span",{css:{color:d.a.colors.blueDarkText,fontWeight:d.a.fontWeights.bold},children:"sharing settings"})]})]}),Object(E.b)(Ke.a,{})]})},Qe=function(e){var t,n,a=e.show,o=e.startSessionJwt,c=e.workspace,s=e.workspacePublicationStatus,i=null!=s.lastSucceededPublication,l=Object(m.useState)(!1),u=Object(r.a)(l,2),p=u[0],f=u[1],h=document.getElementById(S.a.sidebar.overlayContainer),j=Object(U.c)(He.c);return Object(m.useEffect)((function(){j||f(!1)}),[j]),Object(E.c)(E.a,{children:[Object(E.c)("div",{css:{display:a?"flex":"none",flexDirection:"column",height:"100%",width:"100%"},children:[Object(E.b)(b.a,{as:"h3",css:{alignItems:"center",borderBottom:"".concat(d.a.borderWidth.thin," solid ").concat(d.a.colors.greyMedium),color:d.a.colors.navySubtleTextOnLight,display:"flex",fontSize:d.a.fontSizes.medium,margin:0,padding:d.a.spacing.medium},size:500,children:"Publish"}),Object(E.c)("div",{css:{display:"flex",flexDirection:"column",fontSize:d.a.fontSizes.medium,height:"100%",justifyContent:"space-between",padding:d.a.spacing.medium},children:[Object(E.b)("div",{css:{display:"flex",flexDirection:"column"},children:Object(E.b)(x.a,{published:null!=s.lastPublication,children:Object(E.b)(_e,{publicationExists:i,setShowingLogs:f,showingLogs:p,startSessionJwt:o,workspace:c,workspacePublicationStatus:s})})}),i&&Object(E.b)(Ye,{workspace:c})]})]}),p&&null!=h&&Object(y.createPortal)(Object(E.b)(P,{logs:"failed"===(null===s||void 0===s||null===(t=s.lastPublication)||void 0===t?void 0:t.status)||"failed-too-large"===(null===s||void 0===s||null===(n=s.lastPublication)||void 0===n?void 0:n.status)?null===s||void 0===s?void 0:s.lastPublication.logs:null,setShowingLogs:f}),h)]})},Xe=function(e){var t=e.show,n=e.startSessionJwt,a=e.workspace,r=Object(m.useContext)(v.a).editorState,c=Object(m.useContext)(qe.b),s=Je({workspaceId:a.id}).workspacePublicationStatus;switch(r._tag){case"executing":case"editing":return null==s?null:Object(E.b)(Qe,{show:t,startSessionJwt:n,workspace:a,workspacePublicationStatus:s});case"viewing":switch(r.reason){case"session-broken":case"xsrf-problem":case"context-not-ready":return Object(E.c)(Ve.d,{children:[Object(E.b)(u.a,{css:{marginBottom:12,textAlign:"center"},children:"Something went wrong starting your session. Please retry."}),Object(E.b)(k.g,{appearance:"primary",ariaLabel:"retry to get workspaces",onClick:function(){c()},children:"Retry"})]});case"not-allowed":return Object(E.b)(Ve.d,{children:Object(E.b)(u.a,{css:{marginBottom:12,textAlign:"center"},children:"You do not have sufficient permissions to publish this workspace."})});case"no-kernel":case"no-context":case"no-saving":case"loading":return Object(E.b)("div",{css:{alignItems:"center",display:"flex",height:"100%",justifyContent:"center",width:"100%"},children:Object(E.b)(Be.a,{})});default:return Object(o.b)(r)}default:return Object(o.b)(r)}},Ze=n("./src/editor/redux/notebookActions.tsx"),$e=n("./src/editor/useNotebookContext.tsx"),et=n("../../node_modules/@datacamp/waffles/esm/icon/arrow-left.js"),tt=n("./src/editor/useDataSourceExecutorJwt.tsx"),nt=n("./src/ErrorPage.tsx"),at=n("./src/useMultiplexerUrl.tsx"),rt=n("./src/workspace/workspaceLayoutAction.ts"),ot=n("./src/integration/connectedIntegrationSelector.ts"),ct=n("../../node_modules/@datacamp/waffles/esm/icon/more.js"),st=n("./src/dropdown/useDropdown.ts"),it=n("./src/userProfile/userProfileSelector.ts"),lt=n("./src/util/useModal.ts"),ut=n("../../node_modules/@datacamp/waffles-modals/es/Dialog/index.js"),dt=n("./src/integration/FetchCredentialsError.tsx"),bt=n("./src/integration/HowToUseBody.tsx"),pt=n.p+"static/media/how-to-use-database-server-integrations.f5ab3d58.svg",ft=function(e){var t=e.modal;return Object(E.c)(E.a,{children:[Object(E.b)(ut.a.Header,{children:"How to use this integration"}),Object(E.c)(ut.a.Body,{children:[Object(E.b)(u.a,{css:{color:d.a.colors.navySubtleTextOnLight,marginBottom:d.a.spacing.medium},children:"Create a SQL cell and select the integration you want to query, write SQL code and hit run."}),Object(E.b)("img",{alt:"how to use database server integrations",height:250,src:pt})]}),Object(E.c)(ut.a.Footer,{children:[Object(E.b)(k.g,{intent:"neutral",onClick:t.closeModal,children:"Cancel"}),Object(E.b)(k.g,{appearance:"primary",intent:"success",onClick:t.closeModal,children:"Continue"})]})]})},mt=n("./src/integration/ModalSpinner.tsx"),ht=function(e){var t=e.integration,n=e.language,a=Object($.c)((function(){return K.a.credentialsIntegration.getCredentialKeys({params:{integrationId:t.id}})}),[t]),c=Object(r.a)(a,2),s=c[0],i=c[1];switch(Object(m.useEffect)((function(){i()}),[i]),s.type){case"initial":case"initialLoading":return Object(E.b)(mt.a,{});case"reloading":case"ready":return f.b.isLeft(s.value)?Object(E.b)(dt.a,{retry:i}):Object(E.b)(bt.a,{envVariables:s.value.right.credentialKeys,language:n});default:return Object(o.b)(s)}},jt=function(e){switch(e.integration.type){case"credentials":return Object(E.b)(ht,Object(Y.a)({},e));case"mysql":case"postgresql":case"redshift":case"mssql":case"mariadb":case"oracledb":return Object(E.b)(ft,Object(Y.a)({},e));default:return Object(o.b)(e.integration)}},gt=function(e){return Object(E.b)(ut.a,{isOpen:e.modal.modalIsOpen,onClose:e.modal.closeModal,width:650,children:Object(E.b)(jt,Object(Y.a)({},e))})},Ot=n("./src/integration/IntegrationConnectorBody.tsx"),wt=n("./src/integration/useCloseWhenNotLoading.tsx"),vt=function(e){var t=e.integration,n=e.modal,a=n.closeModal,r=n.modalIsOpen,o=e.workspace,c=Object(wt.a)(a),s=c.onClose,i=c.setIsLoading;return Object(E.b)(ut.a,{isOpen:r,onClose:s,width:650,children:Object(E.b)(Ot.a,{integration:t,onSuccess:a,setIsLoading:i,workspace:o})})},kt=n("./src/integration/IntegrationDeleter.tsx"),yt=n("../../node_modules/@datacamp/waffles-modals/es/AlertDialog/index.js"),xt=n("./src/integration/getShortText.ts"),St=n("./src/integration/messages.ts"),Ct=n("../../libs/shared/domain/dist/es/domains/accessControl/owner.js"),It=n("./src/accountSelector/accountSelectorSelector.ts"),Tt=n("./src/integration/connectedIntegrationActions.ts"),_t=n("./src/integration/useIntegrationConnector.tsx"),Et=function(e){var t=e.workspace,n=Object(U.b)(),a=Object(_t.a)(),c=Object(U.c)(It.b),s=null==t?c:Object(Ct.d)(t.owner),i=Object($.c)(function(){var e=Object(he.a)(me.a.mark((function e(r){var o;return me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.a.workspaceIntegration.disconnect({body:{integrationId:r.id,workspaceId:t.id},context:{accountReference:s}});case 2:return o=e.sent,f.b.isRight(o)&&(n(Object(Tt.b)({integrationId:r.id})),a({integrationType:r.type,workspaceId:t.id})),e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n,a,t,s]),l=Object(r.a)(i,2),u=l[0],d=l[1];return Object(m.useEffect)((function(){switch(u.type){case"initial":case"initialLoading":case"reloading":break;case"ready":f.b.isLeft(u.value)&&Object(z.b)({description:"Could not disconnect the integration to the workspace, please try again.",intent:"error",title:"Integration not disconnected"});break;default:Object(o.b)(u)}}),[u]),{disconnect:d,disconnectState:u}},Pt=function(e){var t=e.integration,n=e.modal,a=n.closeModal,r=n.modalIsOpen,o=e.workspace,c=Et({workspace:o}),s=c.disconnect,i=c.disconnectState,l=Object(m.useCallback)((function(){Object($.b)(i)||a()}),[a,i]),u=Object(m.useCallback)((function(){return s(t)}),[s,t]);return Object(E.b)(yt.a,{cancelButtonText:"Cancel",confirmButtonText:"Disconnect",description:St.a,intent:"danger",isOpen:r,loading:Object($.b)(i),onClose:l,onConfirm:f.c.flow(u,a),title:"Disconnect \u201c".concat(Object(xt.a)(t.name),"\u201d from your workspace?")})},zt=n("../../node_modules/@datacamp/waffles/esm/icon/unlink.js"),Lt=n("../../node_modules/@datacamp/waffles/esm/icon/edit.js"),At=n("../../node_modules/@datacamp/waffles/esm/icon/info-circle.js"),Rt=n("../../node_modules/@datacamp/waffles/esm/icon/trash.js"),Dt=n("../../node_modules/@datacamp/waffles-card/es/index.js"),Wt=n("../../node_modules/fp-ts/es6/function.js"),Mt=n("./src/dropdown/index.tsx"),Nt=n("./src/dropdown/getDropdownStyle.tsx"),Ft=function(e){var t=e.className,n=e.isConnected,a=e.onDisconnect,r=e.openCredentialsModal,o=e.openDeleteModal,c=e.openHowToUseModal,s=e.toggleDropdown,i=e.userCanMakeChanges;return Object(E.b)(Dt.a,{className:t,css:{zIndex:d.a.zIndex.default},elevation:3,children:Object(E.c)("ul",{css:[Object(Nt.a)(),{width:140}],children:[Object(E.b)(Mt.b,{Icon:zt.a,action:{onClick:Object(Wt.flow)(s,a),type:"callback-old"},disabled:!n,children:"Disconnect"}),i&&Object(E.b)(Mt.b,{Icon:Lt.a,action:{onClick:Object(Wt.flow)(s,r),type:"callback-old"},children:"Edit"}),Object(E.b)(Mt.b,{Icon:At.a,action:{onClick:Object(Wt.flow)(s,c),type:"callback-old"},children:"How to use"}),i&&Object(E.b)(Mt.b,{Icon:Rt.a,action:{onClick:Object(Wt.flow)(s,o),type:"callback-old"},intent:"danger",children:"Delete"})]})})},Ut=n("./src/integration/UpdateIntegrationModal.tsx"),Jt=function(e){var t=e.onClick;return Object(E.b)(k.g,{appearance:"primary",css:{padding:"2px 9px",span:{fontSize:d.a.fontSizes.small,lineHeight:d.a.lineHeights.relaxed}},intent:"success",onClick:t,size:"small",children:"Connect"})},Bt=function(e){var t=e.className,n=e.integration,a=e.isConnected,r=e.workspace,c=Object(_t.b)({workspaceId:r.id}).connect,s=Et({workspace:r}).disconnect,i=Object(st.a)({offset:4,position:"bottomRight"}),l=i.dropdownButtonRef,u=i.dropdownRef,b=i.dropdownStyle,p=i.toggleDropdown,f=Object(lt.a)(),h=Object(lt.a)(),j=Object(lt.a)(),g=Object(lt.a)(),O=Object(lt.a)(),w=Object(U.c)(it.b),v=Object(m.useMemo)((function(){switch(w.status){case"LOGGED_IN":return w.profile.id===n.creatorId;case"LOGGED_OUT":case"UNINITIALIZED":return!1;default:return Object(o.b)(w)}}),[w,n.creatorId]),y=Object(m.useCallback)((function(){switch(n.type){case"credentials":f.openModal();break;case"mysql":case"postgresql":case"redshift":case"mssql":case"mariadb":case"oracledb":c(n);break;default:Object(o.b)(n)}}),[n,f,c]),x=Object(m.useCallback)((function(){switch(n.type){case"credentials":h.openModal();break;case"mysql":case"postgresql":case"redshift":case"mssql":case"mariadb":case"oracledb":s(n);break;default:Object(o.b)(n)}}),[n,h,s]);return Object(E.c)("div",{className:t,css:{alignItems:"center",color:d.a.colors.greenDarkText,display:"flex"},children:[!a&&Object(E.b)(Jt,{onClick:y}),Object(E.b)(k.g,{ariaLabel:"settings",className:t,css:[{":hover":{backgroundColor:Object(D.d)(d.a.colors.navy,.05)},border:"none",height:d.a.sizing.small,marginLeft:d.a.spacing.xsmall,padding:0,width:d.a.sizing.small}],onClick:p,ref:l,size:"small",children:Object(E.b)(ct.a,{color:d.a.colors.navySubtleTextOnLight})}),Object(E.b)("div",{ref:u,children:Object(E.b)(Ft,{css:[b],isConnected:a,onDisconnect:function(){return x()},openCredentialsModal:O.openModal,openDeleteModal:j.openModal,openHowToUseModal:g.openModal,toggleDropdown:p,userCanMakeChanges:v})}),Object(E.b)(Pt,{integration:n,modal:h,workspace:r}),Object(E.b)(vt,{integration:n,modal:f,workspace:r}),Object(E.b)(kt.a,{integration:n,isConnected:a,modal:j,workspace:r}),Object(E.b)(gt,{integration:n,language:r.language,modal:g}),Object(E.b)(Ut.a,{integration:n,isConnected:a,modal:O})]})},Vt=n("./src/integration/IntegrationTypeIcon.tsx"),qt=n("./src/integration/IntegrationTypesList.tsx"),Ht=function(e){var t=e.className,n=e.detailView,a=e.integration,r=e.isConnected,o=e.workspace,c=Object(U.b)();return Object(E.c)("div",{className:t,css:[{borderBottom:"".concat(d.a.borderWidth.thin," solid ").concat(d.a.colors.greyMedium),display:"flex",gap:d.a.spacing.xsmall,justifyContent:"space-between",padding:d.a.spacing.medium},n&&{borderBottom:"none"},!n&&{":hover":{backgroundColor:Object(D.d)(d.a.colors.navy,.05),cursor:"pointer"}}],"data-trackid":Object(M.c)("select-integration-sidepanel"),onClick:function(){n||c(Object(rt.d)(a.id))},children:[Object(E.c)("div",{css:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[Object(E.c)(b.a,{as:"h2",css:Object(_.q)(2),multiLine:!0,size:500,children:[Object(E.b)(Vt.b,{css:{marginRight:d.a.spacing.small,verticalAlign:"middle"},integrationType:a.type,isConnected:r,size:16}),a.name]}),Object(E.b)(ce.a,{css:{color:d.a.colors.navySubtleTextOnLight,fontSize:d.a.fontSizes.small,marginTop:d.a.spacing.xsmall},children:Object(qt.b)(a.type)})]}),n?Object(E.b)(Bt,{integration:a,isConnected:r,workspace:o}):Object(E.b)("div",{css:_.m,children:Object(E.b)(Ke.a,{color:d.a.colors.navySubtleTextOnLight})})]})},Gt=n("./src/integration/integrationsActions.ts"),Kt=function(e){var t=e.children,n=e.className;return Object(E.b)("div",{className:n,css:{alignItems:"center",borderBottom:"".concat(d.a.borderWidth.thin," solid"),borderColor:d.a.colors.greyMedium,display:"flex",flexShrink:0,height:52,padding:"0 ".concat(d.a.spacing.medium),width:"100%"},children:t})},Yt=n("./src/integration/integrationsSelector.ts"),Qt=n("../../node_modules/@mui/lab/TreeItem/TreeItem.js"),Xt=n("../../node_modules/@mui/lab/TreeView/TreeView.js"),Zt=n("../../node_modules/lodash.partition/index.js"),$t=n.n(Zt),en=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),tn=n("../../node_modules/@datacamp/waffles/esm/icon/matrix.js"),nn=n("../../node_modules/@datacamp/waffles-text/es/components/Badge.js"),an=n("../../node_modules/@mui/lab/TreeItem/treeItemClasses.js"),rn=function(e){var t=e.className;return Object(E.b)("svg",{className:t,fill:"none",height:12,width:12,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",children:Object(E.b)("path",{clipRule:"evenodd",d:"M9.24 3.682a.668.668 0 0 1 .563 1.133L6.47 8.14a.665.665 0 0 1-.973-.036l-3.3-3.298a.667.667 0 0 1 .577-1.13h6.475l-.007.007Z",fill:"#626D79",fillRule:"evenodd"})})},on=function(e){var t=e.expanded;return Object(E.b)(rn,{css:{transform:t?"rotate(0deg)":"rotate(-90deg)",transition:"transform .3s ease-in-out"}})},cn="".concat(d.a.colors.navy,"1a"),sn={overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},ln={base:{color:d.a.colors.navy,fontSize:d.a.fontSizes.small},column:{alignItems:"center",display:"flex",height:"100%",justifyContent:"space-between"},columnBadge:Object(Y.a)({color:d.a.colors.navySubtleTextOnLight,fontSize:10,fontWeight:d.a.fontWeights.regular,lineHeight:"15px",maxWidth:75,minWidth:20,textTransform:"none"},sn),root:{alignItems:"center",display:"flex",height:"100%"},table:Object(Y.a)({bottom:3,position:"relative"},sn),treeView:Object(H.a)({},"& .".concat(an.a.content),(a={},Object(H.a)(a,"&.".concat(an.a.selected),{backgroundColor:"".concat(cn," !important")}),Object(H.a)(a,"&:hover",{backgroundColor:"transparent",border:"".concat(d.a.borderWidth.thin," solid ").concat(cn)}),Object(H.a)(a,"border","".concat(d.a.borderWidth.thin," solid transparent")),Object(H.a)(a,"borderRadius",d.a.borderRadius.medium),Object(H.a)(a,"& .".concat(an.a.label),Object(Y.a)({height:22},sn)),a))},un=["children"],dn=function(e){var t=e.children,n=Object(en.a)(e,un);return Object(E.b)(ce.a,Object(Y.a)(Object(Y.a)({},n),{},{children:Object(E.b)("span",{title:t,children:t})}))},bn=function(e){var t=e.field;return Object(E.c)("div",{css:[ln.base,ln.column],children:[Object(E.b)(dn,{css:Object(Y.a)({fontSize:d.a.fontSizes.small},sn),children:t.name}),Object(E.b)(nn.a,{color:d.a.colors.greyLight,css:ln.columnBadge,children:Object(E.b)("span",{title:t.type,children:t.type})})]})},pn=function(e){var t=e.table;return Object(E.b)(dn,{css:[ln.base,ln.table],children:t.name})},fn=function(e){switch(e){case"views":return"Views";case"tables":return"Tables";default:return Object(o.b)(e)}},mn=function(e){var t=e.tables,n=e.type;return Object(E.c)(ce.a,{css:[ln.base,ln.root],children:[Object(E.b)(tn.a,{css:{height:12,marginRight:d.a.spacing.xsmall,width:12}}),fn(n),Object(E.b)(nn.a,{color:d.a.colors.greyLight,css:{color:d.a.colors.navySubtleTextOnLight,marginLeft:d.a.spacing.xsmall},children:"".concat(t.length)})]})},hn=function(e){var t=e.schemaName,n=e.type;return"schema-".concat(t,"-").concat(n)},jn=function(e){var t=e.schemaName,n=e.tables,a=e.type,r=hn({schemaName:t,type:a});return{children:n.map((function(e){return{children:e.fields.map((function(t){return{id:"".concat(r,"-").concat(e.name,"-").concat(t.name),name:Object(E.b)(bn,{field:t})}})),id:"".concat(r,"-").concat(e.name),name:Object(E.b)(pn,{table:e})}})),id:r,name:Object(E.b)(mn,{tables:n,type:a})}},gn=function e(t){return Object(E.b)(Qt.a,{css:ln.treeView,label:t.name,nodeId:t.id,children:Array.isArray(t.children)?t.children.map((function(t){return e(t)})):null},t.id)},On=function(e){var t,n,a=e.schemas,o=Object(m.useMemo)((function(){return function(e){return e.map((function(e){var t=$t()(e.tables,(function(e){return e.type.toLowerCase().includes("view")})),n=Object(r.a)(t,2),a=n[0],o=n[1];return{tables:jn({schemaName:e.name,tables:o,type:"tables"}),views:jn({schemaName:e.name,tables:a,type:"views"})}}))}(a)}),[a]),c=Object(m.useState)(null!==(t=null===(n=a[0])||void 0===n?void 0:n.name)&&void 0!==t?t:""),s=Object(r.a)(c,2),i=s[0],l=s[1],u=Object(m.useMemo)((function(){return o.find((function(e){return e.tables.id===hn({schemaName:i,type:"tables"})}))}),[i,o]);return null==u?Object(E.b)("div",{children:"no schemas available"}):Object(E.c)("div",{css:{margin:d.a.spacing.small,marginTop:0},children:[Object(E.b)("form",{css:{"label > span":{marginBottom:d.a.spacing.small},"select ~ svg":{top:12}},children:Object(E.b)(ge.a,{css:{border:"".concat(d.a.borderWidth.thin," solid ").concat(d.a.colors.greyDark),boxShadow:"none",height:d.a.sizing.medium,marginBottom:d.a.spacing.medium},label:"Select schema",name:"schema-selector",onChange:l,value:i,children:a.map((function(e){var t=e.name;return Object(E.b)(Oe.a,{value:t,children:t},t)}))})}),Object(E.b)(Xt.a,{"aria-label":"database tables tree",defaultCollapseIcon:Object(E.b)(on,{expanded:!0}),defaultExpandIcon:Object(E.b)(on,{expanded:!1}),defaultExpanded:[u.tables.id],children:gn(u.tables)}),null!=u.views.children&&u.views.children.length>0&&Object(E.b)(Xt.a,{"aria-label":"database views tree",defaultCollapseIcon:Object(E.b)(on,{expanded:!0}),defaultExpandIcon:Object(E.b)(on,{expanded:!1}),defaultExpanded:[u.views.id],children:gn(u.views)})]})},wn=function(){return Object(E.b)("div",{css:[_.m,{fontSize:d.a.fontSizes.medium,marginTop:d.a.spacing.medium,padding:"0 ".concat(d.a.spacing.xlarge),textAlign:"center"}],children:"It\u2019s currently not supported to connect integrations to a workspace when other users have editor access"})},vn=function(){return Object(E.c)("div",{css:[_.m,{flexDirection:"column",height:"100%"}],children:[Object(E.b)(Be.a,{color:d.a.colors.greyMedium}),Object(E.b)("div",{css:{fontSize:d.a.fontSizes.small,marginTop:d.a.spacing.medium,padding:"0 ".concat(d.a.spacing.xlarge),textAlign:"center"},children:"Loading database schema. This may take a moment\u2026"})]})},kn=function(e){var t=e.integration,n=e.isConnected,a=e.workspace,r=Object(U.b)(),c=Object(at.a)(),s=Object(tt.a)(),i=Object(U.c)((function(e){return Object(Yt.b)(e,t.id)})),l=Object(_t.b)({workspaceId:a.id}),u=l.connect,d=l.connectState,b=Object(m.useCallback)((function(){null!=s&&(n?r(Object(Gt.b)({datasourceExecutorJWT:s,integrationId:t.id,multiplexerUrl:c})):u(t))}),[s,u,r,n,t,c]);if(Object(m.useEffect)((function(){null==i&&null!=s&&b()}),[s,i]),"ready"===d.type)if(f.b.isLeft(d.value)&&"notAllEditorsHaveAccess"===d.value.left.errorType)return Object(E.b)(wn,{});switch(null===i||void 0===i?void 0:i.status){case void 0:case"requested":return Object(E.b)(vn,{});case"refreshing":case"succeeded":return Object(E.b)(On,{schemas:i.data});case"failed":return Object(E.b)(nt.a,{onRetry:b});default:return Object(o.b)(i)}},yn=function(e){var t=e.integration,n=e.isConnected,a=e.workspace,r=t.type;switch(r){case"credentials":return null;case"postgresql":case"mysql":case"redshift":case"mssql":case"mariadb":case"oracledb":return Object(E.b)(kn,{integration:t,isConnected:n,workspace:a});default:return Object(o.b)(r)}},xn=function(e){var t=e.integration,n=e.workspace,a=Object(U.b)(),r=Object(U.c)(ot.a).has(t.id);return Object(E.c)("div",{css:{display:"flex",flexDirection:"column",height:"100%",width:"100%"},children:[Object(E.b)(Kt,{children:Object(E.c)(k.g,{ariaLabel:"go back to integrations",css:{"> span":{color:d.a.colors.navySubtleTextOnLight,lineHeight:d.a.lineHeights.tight,textTransform:"none"},"> svg":{color:d.a.colors.navySubtleTextOnLight},border:"none",color:d.a.colors.navySubtleTextOnLight,padding:d.a.spacing.xsmall},onClick:function(){return a(Object(rt.a)())},size:"small",children:[Object(E.b)(et.a,{})," Back to all integrations"]})}),Object(E.b)(Ht,{detailView:!0,integration:t,isConnected:r,workspace:n}),Object(E.b)("div",{css:{flexGrow:1,maxHeight:"100%",overflow:"auto"},children:Object(E.b)(yn,{integration:t,isConnected:r,workspace:n})})]})},Sn=n("../../node_modules/@datacamp/waffles/esm/icon/add-circle.js"),Cn=n("./src/buttons/ShowHideButton.tsx"),In=n("./src/integration/AddIntgrationCard.tsx"),Tn=n("./src/integration/CreateIntegrationModal.tsx"),_n=n("./src/integration/integrationsUtil.ts"),En=n("../../node_modules/react-use/esm/useToggle.js"),Pn=n("../../node_modules/store/dist/store.legacy.js"),zn=n.n(Pn),Ln="dc_workspace_show_sample_integrations",An=function(e){var t=e.className,n=e.connectedIntegrations,a=e.integrations,r=e.workspace;return Object(E.b)("div",{className:t,css:{borderBottom:"".concat(d.a.borderWidth.thin," solid"),borderColor:d.a.colors.greyMedium},children:Object(_n.a)(a,n).map((function(e){return Object(E.b)(Ht,{css:{":last-child":{borderBottom:"none"}},detailView:!1,integration:e,isConnected:n.has(e.id),workspace:r},e.id)}))})},Rn=function(e){var t=e.integrations,n=e.refreshing,a=e.workspace,o=function(){var e=zn.a.get(Ln,!0),t=Object(En.a)(e),n=Object(r.a)(t,2),a=n[0],o=n[1];return Object(m.useEffect)((function(){zn.a.set(Ln,a)}),[a]),{showSampleIntegrations:a,toggleShowSampleIntegrations:o}}(),c=o.showSampleIntegrations,s=o.toggleShowSampleIntegrations,i=Object(U.c)(Ce.b),l=Object(U.c)(ot.a),u=Object(lt.a)(),p=u.closeModal,f=u.modalIsOpen,h=u.openModal,j=$t()(t,(function(e){return e.sample})),g=Object(r.a)(j,2),O=g[0],w=g[1];return Object(E.c)("div",{css:{display:"flex",flexDirection:"column",height:"100%",overflow:"auto",width:"100%"},children:[i&&Object(E.c)(E.a,{children:[Object(E.c)(Kt,{css:{flex:"0 0 auto",justifyContent:"space-between"},children:[Object(E.c)(b.a,{as:"h3",css:{alignItems:"center",color:d.a.colors.navySubtleTextOnLight,display:"flex",gap:d.a.spacing.xsmall},size:500,children:["Integrations",Object(E.b)(nn.a,{color:d.a.colors.greyLight,css:{color:d.a.colors.navySubtleTextOnLight},children:"".concat(w.length)}),n&&Object(E.b)(Be.a,{color:d.a.colors.navy,css:{marginLeft:d.a.spacing.small}})]}),Object(E.b)(k.g,{ariaLabel:"Create integration",css:{border:"none",borderRadius:d.a.borderRadius.circle,color:d.a.colors.navySubtleTextOnLight,height:d.a.sizing.small,padding:0,width:d.a.sizing.small},dataAttributes:{trackid:Object(M.c)("add-integration")},onClick:function(){return h()},tooltipPosition:"left",tooltipText:"Create integration",children:Object(E.b)(Sn.a,{})})]}),Object(E.b)(An,{connectedIntegrations:l,integrations:w,workspace:a}),Object(E.b)("div",{css:{padding:d.a.spacing.medium},children:Object(E.b)(In.a,{workspace:a})})]}),Object(E.c)("div",{children:[Object(E.c)(Kt,{css:{flex:"0 0 auto",justifyContent:"space-between"},children:[Object(E.c)(b.a,{as:"h3",css:{alignItems:"center",color:d.a.colors.navySubtleTextOnLight,display:"flex",gap:d.a.spacing.xsmall},size:500,children:["Sample integrations",Object(E.b)(nn.a,{color:d.a.colors.greyLight,css:{color:d.a.colors.navySubtleTextOnLight},children:"".concat(O.length)})]}),i&&Object(E.b)(Cn.a,{itemNameForAriaLabel:"sample integrations",onClick:s,showing:c})]}),Object(E.b)(An,{connectedIntegrations:l,css:{maxHeight:c?"200%":"0%",overflow:"hidden",transition:"max-height 0.3s ease-in-out"},integrations:O,workspace:a})]}),Object(E.b)(Tn.a,{closeModal:p,isOpen:f,workspace:a})]})},Dn=n("./src/integration/useIntegrations.tsx"),Wn=function(){return Object(E.b)("div",{css:{alignItems:"center",display:"flex",height:"100%",justifyContent:"center",width:"100%"},children:Object(E.b)(Be.a,{color:d.a.colors.navy})})},Mn=function(e){var t=e.retryFetch;return Object(E.c)("div",{css:{alignItems:"center",display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",width:"100%"},children:[Object(E.b)(u.a,{css:{margin:d.a.spacing.medium,textAlign:"center"},children:"Something went wrong when fetching your integrations, please retry."}),Object(E.b)(k.g,{appearance:"primary",ariaLabel:"retry to fetch the integrations",intent:"success",onClick:t,size:"small",children:"Retry"})]})},Nn=function(e){var t=e.workspace,n=Object(Dn.b)({workspaceOwner:t.owner}),a=n.integrationsState,r=n.retryFetchIntegrations;switch(null===a||void 0===a?void 0:a.status){case void 0:case"requested":return Object(E.b)(Wn,{});case"refreshing":case"succeeded":var c="refreshing"===(null===a||void 0===a?void 0:a.status);return Object(E.b)(Rn,{integrations:a.data,refreshing:c,workspace:t});case"failed":return Object(E.b)(Mn,{retryFetch:r});default:return Object(o.b)(a)}},Fn=function(e){var t=e.show,n=e.workspace,a=Object(U.c)(He.b);return t?null!=a?Object(E.b)(xn,{integration:a,workspace:n},a.id):Object(E.b)(Nn,{workspace:n}):null},Un=n("./src/noPaidSeat/noPaidSeatHooks.tsx"),Jn=function(){var e=Object(Un.b)({}),t=e.hasRequestedAccess,n=e.requestAccess;return Object(E.b)("div",{css:{alignItems:"center",background:Object(D.d)(d.a.colors.yellow,.2),boxShadow:"0px 0px 0px 1px ".concat(Object(D.d)(d.a.colors.navy,d.a.opacity.low)),color:d.a.colors.yellowDarkText,display:"flex",fontSize:d.a.fontSizes.medium,justifyContent:"center",padding:d.a.spacing.small},children:t?"You have requested access to edit this workspace.":Object(E.c)(E.a,{children:["You need a Workspace Teams license to edit this workspace.",Object(E.b)(k.g,{css:{background:"transparent !important",border:"none !important",color:"".concat(d.a.colors.yellowDarkText," !important"),height:18,marginLeft:d.a.spacing.xsmall,padding:0,span:{color:"".concat(d.a.colors.yellowDarkText)}},onClick:n,children:"Request Access"}),"."]})})},Bn=n("./src/permission/permissionSelectors.ts"),Vn=n("./src/userProfile/LoginRedirectPage.tsx"),qn=n("./src/util/useValidatedQueryParams.ts"),Hn=n("./src/workspace/LoadingPlaceholder.tsx"),Gn=n("./src/workspace/ScreenSizeProvider.tsx"),Kn=n("./src/editor/redux/notebookHooks.ts"),Yn=Object(c.a)({message:te.w}),Qn=function(e){return Le.b.captureMessage("Received unhandled session status message: ".concat(e)),"unhandled"},Xn=function(e){if(null==e)return"undefined";var t=f.d.parse(e);if(f.b.isLeft(t))return/^[a-zA-Z]/.test(e)?e:Qn(e);var n=Yn.decode(t.right);if(f.b.isLeft(n))return Qn(e);switch(n.right.message){case"An invalid response was received from the upstream server":return"invalid_upstream_response";case"name resolution failed":return"name_resolution_failed";default:return Qn(e)}},Zn=n("../../node_modules/@babel/runtime/helpers/asyncToGenerator.js"),$n=n.n(Zn),ea=n("../../node_modules/@babel/runtime/helpers/classCallCheck.js"),ta=n.n(ea),na=n("../../node_modules/@babel/runtime/helpers/createClass.js"),aa=n.n(na),ra=n("../../node_modules/@babel/runtime/helpers/defineProperty.js"),oa=n.n(ra),ca=n("../../node_modules/@babel/runtime/regenerator/index.js"),sa=n.n(ca),ia=n("../../libs/shared/domain/dist/es/types/PII.js"),la=n("../../libs/shared/domain/dist/es/multiplexerCommands/prepareWorkspace.js"),ua=n("../../libs/components/collab-multiplexer-react-client/node_modules/@datacamp/mfe-util-sentry/dist/esm/index.js"),da=n("../../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),ba=n.n(da),pa=n("../../node_modules/@babel/runtime/helpers/get.js"),fa=n.n(pa),ma=n("../../node_modules/@babel/runtime/helpers/inherits.js"),ha=n.n(ma),ja=n("../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),ga=n.n(ja),Oa=n("../../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),wa=n.n(Oa),va=n("../../node_modules/cross-fetch/dist/browser-ponyfill.js"),ka=n.n(va),ya=n("../../node_modules/lodash.throttle/index.js"),xa=n.n(ya),Sa=n("../../node_modules/qs/lib/index.js"),Ca=n.n(Sa),Ia=n("../../node_modules/uuid/dist/esm-browser/v4.js"),Ta=function(e,t){return{id:Object(Ia.a)(),jsonrpc:"2.0",method:e,params:t}};function _a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ea(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_a(Object(n),!0).forEach((function(t){oa()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Pa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=wa()(e);if(t){var r=wa()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return ga()(this,n)}}var za,La=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Aa=function(){var e=$n()(sa.a.mark((function e(t){var n,a,r,o,c,s,i,l;return sa.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.abortSignal,a=t.multiplexerUrl,r=t.retryOptions,o=t.startOptions,c=t.user,s=function(){var e=$n()(sa.a.mark((function e(){var t,r,s;return sa.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ka()("".concat(a,"/new?").concat(Ca.a.stringify(o)),{body:JSON.stringify(c),credentials:"include",headers:{Accept:"application/json"},method:"POST",signal:n});case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request was not ok");case 5:return e.next=7,t.json();case 7:return r=e.sent,s=r.id,e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i=0,l=function(){var e=$n()(sa.a.mark((function e(){var t,a;return sa.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s();case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),!n.aborted){e.next=10;break}throw e.t0;case 10:if(!(i<(null!==(t=null===r||void 0===r?void 0:r.nbOfRetry)&&void 0!==t?t:0))){e.next=15;break}return i++,e.next=14,La(null!==(a=null===r||void 0===r?void 0:r.delay)&&void 0!==a?a:0);case 14:return e.abrupt("return",l());case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",l());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ra=function(e,t,n,a,r){var o={},c=function(e){var t=e.onBatchMessage,n=e.onNotification,a=e.onRequest,r=e.onResponse;return function(e){Array.isArray(e)?t(e):"id"in e?"method"in e?a(e):r(e):n(e)}}({onBatchMessage:function(e){},onNotification:function(e){r(e)},onRequest:function(e){},onResponse:function(e){a(e);var t=o[e.id];delete o[e.id],null!=t&&t(e)}}),s=function(e,t){return Object(Ae.a)(e,{autoConnect:!0,query:{multiplexerSessionId:t}})}(e,t),i=function(){s.disconnect()};s.on("json-rpc",c);var l=function(e){s.emit("json-rpc",e)};s.on("status",(function(e){n({message:e,status:"broken"}),i()}));return{close:i,notify:function(e,t){l(function(e,t){return{jsonrpc:"2.0",method:e,params:t}}(e,t))},request:function(){var e=$n()(sa.a.mark((function e(t,a){var r;return sa.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n({status:"busy"}),e.next=3,new Promise((function(e,n){var r,c;r=Ta(t,a),c=function(t){"error"in t?n(t):e(t)},o[r.id]=c,l(r)}));case 3:return r=e.sent,n({status:"ready"}),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),stopSession:function(){s.emit("stop"),i()}}},Da=function(e){return new Proxy({},{get:function(t,n,a){if("string"!==typeof n)throw new Error("The method is not a string");return function(t){return e.request(n,t).then((function(e){return e.result}))}}})},Wa=function(){function e(){ta()(this,e),oa()(this,"subscribers",new Set)}return aa()(e,[{key:"emit",value:function(e){this.subscribers.forEach((function(t){return t(e)}))}},{key:"subscribe",value:function(e){this.subscribers.add(e)}},{key:"unsubscribe",value:function(e){this.subscribers.delete(e)}},{key:"unsubscribeAll",value:function(){this.subscribers.clear()}}]),e}(),Ma=function(e){ha()(n,e);var t=Pa(n);function n(){var e;ta()(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r)),oa()(ba()(e),"latestValue",{type:"none"}),e}return aa()(n,[{key:"emit",value:function(e){fa()(wa()(n.prototype),"emit",this).call(this,e),this.latestValue={type:"some",value:e}}},{key:"subscribe",value:function(e){fa()(wa()(n.prototype),"subscribe",this).call(this,e),"some"===this.latestValue.type&&e(this.latestValue.value)}},{key:"get",value:function(){return"none"===this.latestValue.type?null:this.latestValue.value}}]),n}(Wa),Na=function(){function e(t){var n=this;ta()(this,e),this.options=t,oa()(this,"status",void 0),oa()(this,"outputs",void 0),oa()(this,"notifications",void 0),oa()(this,"remoteSession",null),oa()(this,"finalizers",new Wa),oa()(this,"rpcSocket",null),oa()(this,"sendFakeKeepAliveCommand",xa()((function(){var e;null===(e=n.rpcSocket)||void 0===e||e.notify("keep_alive",void 0)}),3e5)),this.status=new Ma,this.finalizers.subscribe((function(){n.status.emit({status:"none"}),n.status.unsubscribeAll()})),this.outputs=new Wa,this.finalizers.subscribe((function(){n.outputs.unsubscribeAll()})),this.notifications=new Wa,this.finalizers.subscribe((function(){n.notifications.unsubscribeAll()}))}return aa()(e,[{key:"start",value:function(){var e=$n()(sa.a.mark((function e(){var t,n,a,r,o,c,s,i=this;return sa.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.status.emit({status:"none"}),n=new AbortController,this.finalizers.subscribe((function(){n.abort()})),e.prev=3,e.next=6,Aa(Ea(Ea({},this.options),{},{abortSignal:n.signal}));case 6:a=e.sent,e.next=19;break;case 9:if(e.prev=9,e.t0=e.catch(3),!n.signal.aborted){e.next=14;break}return this.status.emit({message:"abortedRequestedToGetSession",status:"broken"}),e.abrupt("return");case 14:if(!(e.t0 instanceof Error&&"Network request failed"===e.t0.message)){e.next=17;break}return this.status.emit({message:"networkFailureToGetSession",status:"broken"}),e.abrupt("return");case 17:throw this.status.emit({message:"failedToGetSession",status:"broken"}),e.t0;case 19:this.status.emit({status:"ready"}),this.rpcSocket=Ra(this.options.multiplexerUrl,a,(function(e){return i.status.emit(e)}),(function(e){return i.outputs.emit(e)}),(function(e){return i.notifications.emit(e)})),this.remoteSession=Da(this.rpcSocket),this.finalizers.subscribe((function(){var e;null===(e=i.rpcSocket)||void 0===e||e.close(),i.rpcSocket=null,i.remoteSession=null})),null!=this.options.initCommand&&(r=this.options.initCommand,o=r.method,c=r.params,this.rpcSocket.request(o,c)),null!==(t=this.options.sendFakeRequestsToKeepAlive)&&void 0!==t&&t&&(s=setInterval((function(){i.sendFakeKeepAliveCommand()}),3e5),this.finalizers.subscribe((function(){clearInterval(s)})));case 25:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"input",value:function(e){var t;return null===(t=this.rpcSocket)||void 0===t?void 0:t.request(e.method,e.params)}},{key:"notify",value:function(e){var t;return null===(t=this.rpcSocket)||void 0===t?void 0:t.notify(e.method,e.params)}},{key:"closeConnection",value:function(){this.finalizers.emit(),this.finalizers.unsubscribeAll()}},{key:"stop",value:function(){var e;null===(e=this.rpcSocket)||void 0===e||e.stopSession(),this.closeConnection()}}]),e}(),Fa=n("../../node_modules/history/esm/history.js"),Ua=function(e){return"backend-error"===e.type},Ja=function(){function e(t,n,a,r,o,c,s,i,l,u,d,b){ta()(this,e),this.multiplexerUrl=n,this.source=s,this.userJwt=i,this.startSessionJwt=l,this.isPremium=u,this.sentryClient=d,this.workspaceInitialized=b,oa()(this,"image",void 0),oa()(this,"client",void 0),oa()(this,"status",{status:"none"});var p=function(){var e=Object(Fa.a)(),t=Ca.a.parse(e.location.search,{ignoreQueryPrefix:!0});return{image:t.image,runtimeConfig:t.runtime_config,sharedImage:t.shared_image}}(),f=p.image,m=p.runtimeConfig,h=p.sharedImage;this.image=f,this.client=new Na({multiplexerUrl:n,retryOptions:{delay:1e3,nbOfRetry:10},sendFakeRequestsToKeepAlive:!1,startOptions:{editor:a.editor,force_new:c,image:f,language:"python",runtime_config:null!==m&&void 0!==m?m:"collab",shared_image:h},user:{authentication_token:t.authenticationToken,email:Object(ia.b)(t.email),startSessionJwt:l}}),this.client.outputs.subscribe((function(e){o("error"in e?[{error:e.error,type:"backend-error"}]:e.result)})),this.client.notifications.subscribe((function(e){var t=e.method,n=e.params;t in r&&(0,r[t])(n)}))}return aa()(e,[{key:"start",value:function(){var e=$n()(sa.a.mark((function e(){var t,n,a,r;return sa.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.start();case 2:return e.next=4,null===(t=this.remoteSession)||void 0===t?void 0:t.prepare_workspace({source:Object(la.b)(this.source),start_session_jwt:this.startSessionJwt,user_jwt:this.userJwt,workspace_initialized:this.workspaceInitialized});case 4:if(null!=(n=e.sent)){e.next=7;break}return e.abrupt("return",null);case 7:return e.prev=7,e.next=10,null===(a=this.remoteSession)||void 0===a?void 0:a.start_cpu_and_ram_notifications({cpu_requested:this.isPremium?2:.5,ram_requested:this.isPremium?8e3:2e3});case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),this.sentryClient.captureMessage("Failed to start CPU and RAM notifications",{extra:{error:e.t0},level:ua.a.Error});case 15:return r="".concat(this.multiplexerUrl).concat(n[0].payload),e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this,[[7,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){return this.client.closeConnection()}},{key:"subscribeToStatus",value:function(e){var t=this;this.client.status.subscribe((function(n){t.status.status!==n.status&&(t.status=n,e(n))}))}},{key:"notify",value:function(e){return this.client.notify(e)}},{key:"remoteSession",get:function(){var e;return null===(e=this.client)||void 0===e?void 0:e.remoteSession}}]),e}(),Ba=n("./src/editor/useEffectWithAbort.ts"),Va=n("./src/userProfile/activeProductHooks.ts"),qa=n("./src/useTimetracker.tsx"),Ha={forceNew:!1,jupyterFrontendUrl:null,multiplexerSessionManager:null,multiplexerUrl:"",outputs:[],status:{status:"none"}},Ga=function(e,t){switch(t.type){case"setJupyterFrontendUrl":return Object(Y.a)(Object(Y.a)({},e),{},{jupyterFrontendUrl:t.jupyterFrontendUrl});case"prepareRestart":return Object(Y.a)(Object(Y.a)({},Ha),{},{forceNew:t.forceNew});case"startSession":return Object(Y.a)(Object(Y.a)({},Ha),{},{multiplexerSessionManager:t.multiplexerSessionManager,multiplexerUrl:t.multiplexerUrl});case"setStatus":return Object(Y.a)(Object(Y.a)({},e),{},{status:t.status});case"getNewOutputs":return Object(Y.a)(Object(Y.a)({},e),{},{outputs:e.outputs.concat(t.outputs)});default:return e}},Ka=function(e){var t=e.multiplexerProps,n=e.notificationHandlers,a=e.onFailureToGetSession,o=e.onSessionStarted,c=e.url,s=Object(m.useReducer)(Ga,Ha),i=Object(r.a)(s,2),l=i[0],u=i[1],d=Object(Va.d)();Object(Ba.a)((function(e){var r=function(e){if(null==t)return null;var r=t.contentData,s=t.sessionProfile,i=t.source,b=t.startSessionJwt,p=t.userJwt,f=t.workspaceInitialized;if(null==s)return null;var m=new Ja(s,c,r,n,(function(e){return u({outputs:e,type:"getNewOutputs"})}),l.forceNew,i,p,b,d,Le.b,f);return m.subscribeToStatus((function(e){u({status:e,type:"setStatus"})})),u({multiplexerSessionManager:m,multiplexerUrl:m.multiplexerUrl,type:"startSession"}),o(),m.start().then((function(t){null!=t&&(e.aborted||u({jupyterFrontendUrl:t,type:"setJupyterFrontendUrl"}))})).catch(a),m}(e);return function(){null===r||void 0===r||r.stop()}}),[null===t||void 0===t?void 0:t.startSessionJwt]),function(e){var t=e.multiplexerSessionManager,n=Object(m.useCallback)((function(){var e;return null===t||void 0===t||null===(e=t.client)||void 0===e?void 0:e.sendFakeKeepAliveCommand()}),[null===t||void 0===t?void 0:t.client]);Object(qa.a)({onActivity:n}),Object(qa.c)({onActivity:n})}({multiplexerSessionManager:l.multiplexerSessionManager});var b=Object(m.useCallback)((function(e){u({forceNew:e,type:"prepareRestart"})}),[]);return Object(m.useMemo)((function(){return null==(null===t||void 0===t?void 0:t.source)?null:{jupyterFrontendUrl:l.jupyterFrontendUrl,multiplexerSessionManager:l.multiplexerSessionManager,multiplexerUrl:l.multiplexerUrl,outputs:l.outputs,prepareRestart:b,source:null===t||void 0===t?void 0:t.source,status:l.status}}),[b,l.multiplexerSessionManager,l.jupyterFrontendUrl,l.multiplexerUrl,l.outputs,l.status,null===t||void 0===t?void 0:t.source])},Ya=n("./src/workspace/JupyterContext.ts"),Qa=n("./src/editor/useDisposable.ts"),Xa=function(e){switch(e){case"Python":return"python3";case"R":return"ir";default:return Object(o.c)(e,"python3")}},Za=n("../../node_modules/@jupyterlab/codemirror/lib/index.js"),$a=n("../../node_modules/@jupyterlab/docregistry/lib/registry.js"),er=n("../../node_modules/@jupyterlab/notebook/lib/modelfactory.js"),tr=n("../../node_modules/@jupyterlab/services/lib/index.js"),nr=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),ar=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js"),rr=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),or=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get.js"),cr=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),sr=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js"),ir=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js"),lr=n("../../node_modules/@jupyterlab/docmanager/lib/manager.js"),ur=n("../../node_modules/@lumino/signaling/dist/index.es6.js"),dr=function(e){Object(sr.a)(n,e);var t=Object(ir.a)(n);function n(){var e;Object(nr.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r)))._disposed=new ur.Signal(Object(rr.a)(e)),e}return Object(ar.a)(n,[{key:"disposed",get:function(){return this._disposed}},{key:"dispose",value:function(){this._disposed.emit("dispose"),Object(or.a)(Object(cr.a)(n.prototype),"dispose",this).call(this)}}]),n}(lr.a),br=function(e){var t=tr.ServerConnection.makeSettings(e);return Object(Y.a)(Object(Y.a)({},t),{},{init:Object(Y.a)(Object(Y.a)({},t.init),{},{credentials:"include"})})},pr=n("./src/util/noop.ts"),fr=function(e){var t=e.jupyterFrontendUrl,n=e.workspaceId,a=e.workspaceJwt,o=Object(m.useRef)(pr.a),c=Object(m.useRef)(pr.a),s=Object(m.useState)((function(){return new Promise((function(e,t){o.current=e,c.current=t}))})),i=Object(r.a)(s,1)[0],l=function(e){var t=Object(at.a)(),n=e.replace("/lab/workspaces/auto-O/tree/notebook.ipynb","");return null!=Re.a.urls.multiplexerProxy&&(n=n.replace(t,Re.a.urls.multiplexerProxy)),n}(t),u=function(e){var t=e.baseUrl,n=e.readyForDispose,a=Object(Qa.c)(null),o=Object(r.a)(a,2),c=o[0],s=o[1];return Object(m.useEffect)((function(){var e=br({baseUrl:t}),a=new tr.ServiceManager({serverSettings:e}),r=new $a.a,o=new er.a({});r.addModelFactory(o);var c=new dr({manager:a,opener:{open:function(e){}},registry:r}),i=new Za.b,l={documentManager:c,documentRegistry:r,serviceManager:a};s(Object(Y.a)(Object(Y.a)({},l),{},{dispose:function(){Promise.all([a.ready,n]).finally((function(){try{a.kernelspecs.dispose(),a.sessions._kernelManager.dispose(),c.dispose(),r.dispose(),a.dispose()}catch(e){}}))},get isDisposed(){return Object.values(l).some((function(e){return e.isDisposed}))},mimeService:i}))}),[t,n,s]),c}({baseUrl:l,readyForDispose:i}),d=function(e){var t=Object(U.c)(Ce.c),n=null===t||void 0===t?void 0:t.language,a=Object(Qa.d)(Object(he.a)(me.a.mark((function t(){var a,r;return me.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=e&&null!=n){t.next=2;break}return t.abrupt("return",null);case 2:return a=e.serviceManager,t.prev=3,t.next=6,a.ready;case 6:if(!a.isDisposed){t.next=8;break}return t.abrupt("return",null);case 8:return t.next=10,a.sessions.startNew({kernel:{name:Xa(n)},name:$e.b,path:$e.b,type:"notebook"});case 10:return r=t.sent,t.abrupt("return",r);case 14:return t.prev=14,t.t0=t.catch(3),Le.b.captureException(t.t0),t.abrupt("return",null);case 18:case"end":return t.stop()}}),t,null,[[3,14]])}))),[e,n],"keep-old-disposable-around-while-loading-new-one");return null===a||void 0===a?void 0:a.kernel}(u);return{baseUrl:l,context:Object($e.c)({notebookServices:u,onNotebookContextInitializationFailed:c.current,onNotebookContextInitialized:o.current,workspaceId:n,workspaceJwt:a}).context,kernel:d,notebookServices:u}},mr=n("./src/editor/redux/awarenessHooks.ts"),hr=n("./src/editor/useShouldSyncDocumentsOnBackend.ts"),jr=n("./src/util/useStable.ts"),gr=n("../../node_modules/@jupyterlab/coreutils/lib/index.js"),Or=function(e){var t,n=e.multiplexerUrl,a=e.notebookModel,r=e.onStatusUpdate,o=e.sharedModelUser,c=e.shouldSyncDocumentsOnBackend,s=e.workspaceId,i=e.workspaceJwt;if(null==i)return pr.a;var l=a.sharedModel;l.ydoc.getMap("context").set("path",$e.b);var u=br({baseUrl:n}),d=gr.URLExt.join(null!==(t=Re.a.urls.contentSyncerOverride)&&void 0!==t?t:u.wsUrl,"content/sync"),b=Object($e.a)({editingEnabled:!1,onStatusUpdate:r,resetNotebookOnInitialSync:!0,sharedModelUser:o,shouldSyncDocumentsOnBackend:c,url:d,workspaceId:s,workspaceJwt:i})({contentType:"notebook",path:$e.b,ymodel:l});return function(){b.destroy()}},wr=n("../../node_modules/@jupyterlab/notebook/lib/model.js"),vr=function(){var e=Object(he.a)(me.a.mark((function e(){return me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f.b.right(new wr.a));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),kr=function(){var e=Object(he.a)(me.a.mark((function e(t){var n,a,r,o,c;return me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.file,a=t.multiplexerUrl,r=t.viewWorkspaceJwt,e.prev=1,e.next=4,fetch("".concat(a,"/files/read"),{body:JSON.stringify({file:n,viewWorkspaceJwt:r}),credentials:"include",method:"POST"});case 4:if((o=e.sent).ok){e.next=7;break}return e.abrupt("return",f.b.left("failed-to-fetch-file"));case 7:return e.next=9,o.text();case 9:return c=e.sent,e.abrupt("return",f.b.right(c));case 13:return e.prev=13,e.t0=e.catch(1),e.abrupt("return",f.b.left("failed-to-fetch-file"));case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t){return e.apply(this,arguments)}}(),yr=function(){var e=Object(he.a)(me.a.mark((function e(t){var n,a,r,o,c;return me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.multiplexerUrl,a=t.workspaceId,r=t.workspaceJwt,e.next=3,kr({file:$e.b,multiplexerUrl:n,viewWorkspaceJwt:r});case 3:if(o=e.sent,!f.b.isLeft(o)){e.next=6;break}return e.abrupt("return",o);case 6:return e.prev=6,(c=new wr.a).fromJSON(JSON.parse(o.right)),e.abrupt("return",f.b.right(c));case 12:return e.prev=12,e.t0=e.catch(6),Le.b.captureMessage("Viewing workspace but failed to parse notebook json",{level:Le.a.Warning,tags:{workspaceId:a}}),e.abrupt("return",f.b.left("failed-to-create-notebook-model-from-file"));case 16:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t){return e.apply(this,arguments)}}(),xr=function(e){var t=e.jupyterFrontendUrl,n=e.setJupyterContext,a=e.workspaceId,r=e.workspaceJwt,o=fr({jupyterFrontendUrl:t,workspaceId:a,workspaceJwt:r}),c=o.baseUrl,s=o.context,i=o.kernel,l=o.notebookServices;return Object(m.useEffect)((function(){n((function(){return{_tag:"editable",baseUrl:c,context:s,kernel:i,notebookServices:l}}))}),[n,l,i,s,c]),null},Sr=Object(m.memo)(xr),Cr=function(e){return function(e){var t=e.setInitializeNotebookFileFetchError,n=e.setJupyterContext,a=e.workspaceId,r=e.workspaceJwt,c=Object(at.a)(),s=Object(U.b)(),i=Object(mr.d)({app:"DCStudio",isViewer:!0}),l=Object(U.c)(Kn.d),u=Object(hr.a)(),d=Object(m.useCallback)(Object(he.a)(me.a.mark((function e(){return me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(u?vr:yr)({multiplexerUrl:c,workspaceId:a,workspaceJwt:r}));case 1:case"end":return e.stop()}}),e)}))),[a,r,c,u]),b=Object(jr.a)((function(){return new Za.b}),[]),p=Object(m.useCallback)((function(){n((function(e){switch(e._tag){case"uninitialized":case"view-only":return{_tag:"view-only",mimeService:b};case"editable":return e;default:return Object(o.b)(e)}}))}),[n,b]);Object(m.useEffect)((function(){var e=function(){var e=Object(he.a)(me.a.mark((function e(){var n,b,m;return me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==l){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,d();case 4:if(n=e.sent,!f.b.isLeft(n)){e.next=13;break}e.t0=n.left,e.next="failed-to-create-notebook-model-from-file"===e.t0?9:"failed-to-fetch-file"===e.t0?10:12;break;case 9:throw new Error("invalid notebook file");case 10:return t("failed-to-fetch"),e.abrupt("return",null);case 12:throw Object(o.b)(n);case 13:return Object(Ze.l)({dispatch:s,notebookModel:n.right}),b=function(){},m=Or({multiplexerUrl:c,notebookModel:n.right,onStatusUpdate:b,sharedModelUser:i,shouldSyncDocumentsOnBackend:u,workspaceId:a,workspaceJwt:r}),p(),e.abrupt("return",m);case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n=e();return function(){n.then((function(e){return null===e||void 0===e?void 0:e()}))}}),[]),Object(m.useMemo)((function(){return new Za.b}),[])}({setInitializeNotebookFileFetchError:e.setInitializeNotebookFileFetchError,setJupyterContext:e.setJupyterContext,workspaceId:e.workspaceId,workspaceJwt:e.workspaceJwt}),null},Ir=Object(m.memo)(Cr),Tr=function(e){var t=e.jupyterFrontendUrl,n=e.multiplexerStatus,a=e.setInitializeNotebookFileFetchError,r=e.setJupyterContext,o=e.workspaceId,c=e.workspaceJwt,s=Object(m.useContext)(v.a),i=s.editingAllowed,l=s.xsrfState,u=Object(Ya.c)().context;return Object(E.c)(E.a,{children:[(null==u||"broken"===n)&&Object(E.b)(Ir,{setInitializeNotebookFileFetchError:a,setJupyterContext:r,workspaceId:o,workspaceJwt:c}),null!=t&&"broken"!==n&&i&&"success"===l&&Object(E.b)(Sr,{jupyterFrontendUrl:t,setJupyterContext:r,workspaceId:o,workspaceJwt:c})]})},_r=Object(m.memo)(Tr),Er=function(e){var t,n=e.children,a=e.editorType,o=e.multiplexerProps,c=e.onFailureToGetSession,s=e.onSessionStarted,i=e.workspace,l=e.workspaceId,u=e.workspaceJwt,d=Object(at.a)(),b=Object(U.b)(),p=null!==(t=Ka({multiplexerProps:o,notificationHandlers:{update_cpu_ram_usage:function(e){var t=e.cpu,n=e.ram;b({cpu:t,ram:n,type:"UPDATE_CPU_RAM"})}},onFailureToGetSession:c,onSessionStarted:s,url:d}))&&void 0!==t?t:ve.b,f=Object(m.useState)(Ya.b),h=Object(r.a)(f,2),j=h[0],g=h[1],O=Object(m.useState)(void 0),w=Object(r.a)(O,2),k=w[0],y=w[1];return Object(We.jsx)(ve.a.Provider,{value:p,children:Object(We.jsx)(Ya.a.Provider,{value:j,children:Object(We.jsxs)(v.b,{initializeNotebookFileFetchError:k,workspace:i,children:["dcStudioEditor"===a&&Object(We.jsx)(_r,{jupyterFrontendUrl:p.jupyterFrontendUrl,multiplexerStatus:p.status.status,setInitializeNotebookFileFetchError:y,setJupyterContext:g,workspaceId:l,workspaceJwt:u}),n]})})})},Pr=n("../../node_modules/@datacamp/waffles/esm/icon/publish.js"),zr=n("../../node_modules/@datacamp/waffles/esm/icon/desktop.js"),Lr=n("../../node_modules/@datacamp/waffles/esm/icon/folder.js"),Ar=n("../../node_modules/@datacamp/waffles/esm/icon/team.js"),Rr=n("./src/workspace/ShortcutOverview.tsx"),Dr=n("./src/workspace/SideBarButton.tsx"),Wr=function(e){var t=e.activeView,n=e.setActiveView,a=e.shouldRestartBeforePublish,r=e.showEditorButton,o=e.showFileBrowserButton,c=e.showIntegrationsButton,s=e.showPublicationButton,i=e.showShortcutsButton,l=Object(m.useContext)(v.a).editingEnabled,u=Object(m.useCallback)((function(e){null!=document.activeElement&&document.activeElement.blur(),n(e)}),[n]),b=Object(m.useContext)(qe.b),p=l&&i;return!r&&!o&&!c&&!s&&!p?null:Object(E.c)("div",{css:{backgroundColor:d.a.colors.navy,height:"100%",minWidth:_.f,paddingTop:d.a.spacing.small,width:_.f,zIndex:2},children:[s&&Object(E.c)(E.a,{children:[Object(E.b)(Dr.a,{Icon:Pr.a,css:Object(Dr.b)("publish"===t),dataAttributes:{trackid:Object(M.c)("open-publish-panel")},name:"Publish",onClick:function(){u("publish"===t?"editor":"publish"),a&&b()}}),Object(E.b)("hr",{css:{border:"".concat(d.a.borderWidth.thin," 0 0 0 solid ").concat(d.a.colors.white),margin:"".concat(d.a.spacing.small," 13px"),opacity:.3}})]}),r&&Object(E.b)(Dr.a,{Icon:zr.a,css:Object(Dr.b)("editor"===t),dataAttributes:{trackid:Object(M.c)("open-editor-panel")},name:"Editor",onClick:function(){return u("editor")}}),o&&Object(E.b)(Dr.a,{Icon:Lr.a,css:Object(Dr.b)("filebrowser"===t),dataAttributes:{trackid:Object(M.c)("open-filebrowser-panel")},name:"Browse and upload files",onClick:function(){return u("filebrowser"===t?"editor":"filebrowser")}}),c&&Object(E.b)(Dr.a,{Icon:Ar.a,css:Object(Dr.b)("integrations"===t),dataAttributes:{trackid:Object(M.c)("open-integrations-panel")},name:"Integrations",onClick:function(){return u("integrations"===t?"editor":"integrations")}}),p&&Object(E.b)(Rr.a,{})]})},Mr=n("../../node_modules/@datacamp/waffles-modals/es/sharedStyles.js"),Nr=function(e){var t=e.children,n=e.className,a=e.isOpen,o=e.onClose,c=e.width,s=e.withOverlay,i=void 0===s||s,l=Object(m.useState)(a),u=Object(r.a)(l,2),b=u[0],f=u[1];Object(m.useEffect)((function(){f(a)}),[a]);var h=Object(m.useCallback)((function(){o(),f(!1)}),[o]),j=Object(m.useRef)(null),g=Object(m.useCallback)((function(e){j.current===e.target&&h()}),[h]),O=Object(m.useRef)(null),w=Object(m.useState)(a),v=Object(r.a)(w,2),k=v[0],y=v[1];Object(m.useEffect)((function(){var e,t;b?(e=window.setTimeout((function(){return requestAnimationFrame((function(){return y(!0)}))}),10),null===(t=O.current)||void 0===t||t.focus()):e=window.setTimeout((function(){return y(!1)}),600);return function(){window.clearTimeout(e)}}),[b]);var x=b&&k;return Object(E.c)(E.a,{children:[Object(E.b)("div",{className:n,css:Object(p.c)([i&&Mr.b,{display:b||k?void 0:"none",opacity:x?1:0,position:i?"absolute":"block",transition:"opacity 0.6s cubic-bezier(0.19, 1, 0.22, 1)",zIndex:d.a.zIndex.default}]),onClick:g,ref:j,children:Object(E.b)("div",{css:{backgroundColor:d.a.colors.white,borderRight:"".concat(d.a.borderWidth.thin," solid ").concat(d.a.colors.greyMedium),height:"100%",left:0,overflow:"hidden",position:"absolute",transform:x?"none":"translateX(-".concat(c,"px)"),transition:"transform 0.6s cubic-bezier(0.19, 1, 0.22, 1)",width:c},ref:O,tabIndex:0,children:t})}),Object(E.b)("div",{css:{zIndex:5},id:S.a.sidebar.overlayContainer})]})},Fr=n("./src/useProductAccessWithBlacklisted.tsx"),Ur=n("../../libs/shared/domain/dist/es/types/Email.js"),Jr=n("../../libs/shared/domain/dist/es/domains/workspace/domain.js"),Br=n("../../libs/shared/domain/dist/es/domains/workspace/api.js"),Vr=function(){var e=function(){var e=Object(m.useState)({status:"uninitialized"}),t=Object(r.a)(e,2),n=t[0],a=t[1],c=Object(U.b)();return[n,Object(m.useCallback)((function(e,t){switch(a(e),e.status){case"error":c(Object(pe.e)(e.value,t));break;case"loaded":c(Object(pe.f)(e.value));break;case"uninitialized":case"loading":break;default:Object(o.b)(e)}}),[c])]}(),t=Object(r.a)(e,2),n=t[0],a=t[1],c=Object(m.useCallback)(function(){var e=Object(he.a)(me.a.mark((function e(t){var n;return me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a({status:"loading"},t),e.next=3,K.a.workspace.getForEditor({params:{id:t}});case 3:return n=e.sent,e.abrupt("return",f.c.pipe(n,f.b.foldW((function(e){switch(e.errorType){case"verifiedUserPolicyWithoutPaidSeatError":switch(e.body.message){case Br.i:return{status:"error",value:"notSignedIn"};case Br.h:return{status:"error",value:"needsToAcceptBetaTerms"};case Br.e:return{status:"error",value:"b2c2bBlockedFromUsingWorkspace"};case Br.f:case Br.a:return{status:"error",value:"blockedFromUsingWorkspace"};default:return Object(o.c)(e.body.message,{status:"error",value:"cannotStartWorkspace"})}case"notFoundError":return{status:"error",value:"workspaceNotFound"};case"noWorkspaceJwtError":return{status:"error",value:"noStartSessionJwt"};case"denyToAccessSomeIntegrations":return{status:"error",value:"denyToAccessSomeIntegrations"};case"failedToFetchGroupsError":return{status:"error",value:"failedToFetchGroupsError"};case G.a:return{status:"error",value:"cannotStartWorkspace"};default:return Object(o.b)(e)}}),(function(e){return{status:"loaded",value:e}})),(function(e){return a(e,t),e})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[a]);return{fetchWorkspace:c,workspaceState:n}},qr=function(e){var t=e.loadingIsSlow,n=e.restartSession;return Object(E.b)(Hn.a,{children:Object(E.b)(k.g,{css:{marginTop:d.a.spacing.medium,visibility:t?"initial":"hidden"},onClick:function(){return n({forceNew:!0})},children:"Restart session"})})},Hr=n("./src/workspace/Reconnector.tsx"),Gr=n("./src/workspace/useLoadingSessionIsSlow.tsx"),Kr=n("./src/workspace/useShowWarningWhenExceedsSoftLimitSize.tsx"),Yr=Object(m.forwardRef)((function(e,t){var n=e.onEditorLoaded,a=e.startWorkspaceSessionState,o=e.timetrackerId,c=e.userProfile,s=e.workspaceId,i=e.workspaceSize,l=Object(hr.a)(),u=Object(at.a)(),d=Object(m.useContext)(qe.b),b=Object(ve.c)(),f=b.jupyterFrontendUrl,h=b.status,j=Object(m.useState)(!1),g=Object(r.a)(j,2),O=g[0],w=g[1],v=Object(mr.d)({app:"JupyterLab",isViewer:!1}),k=null==v?"":"?".concat(Ca.a.stringify({usercolor:v.color.replace("#",""),username:v.name})),y=Object(m.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.forceNew;w(!1),d({forceNew:t})}),[d]),x=Object(Gr.a)({isSessionReady:O});return Object(Kr.a)(i),Object(qa.b)({appName:"workspace",primaryId:o,userId:c.id}),Object(m.useEffect)((function(){if("loaded"!==a.status)return pr.a;var e=function(e){if(e.origin===u)try{var t;if("docProviderConfigRequest"===JSON.parse(e.data).type)null===(t=e.source)||void 0===t||t.postMessage(JSON.stringify({jwt:a.value.workspaceJwt,sharedModelUser:v,shouldSyncDocumentsOnBackend:l,type:"docProviderConfigResponse",workspaceId:s}),e.origin)}catch(n){}};return window.addEventListener("message",e,!1),function(){window.removeEventListener("message",e)}}),[v,a,l,s,u]),Object(m.useEffect)((function(){(function(e,t){return"loaded"!==e.status||t!==e.value.workspace.id})(a,s)&&O&&w(!1)}),[O,a,s]),"broken"===h.status?Object(E.b)(Hr.a,{multiplexerStatusMessage:h.message,restartSession:y,workspaceId:s}):Object(E.c)("div",{css:Object(p.c)({flexGrow:1,height:0,position:"relative",width:"100%"}),children:[!O&&Object(E.b)(qr,{loadingIsSlow:x,restartSession:y}),null!=f&&Object(E.b)("div",{css:{height:"100%",position:"relative",width:"100%"},children:Object(E.b)("iframe",{css:{border:"none",height:"100%",width:"100%"},onLoad:function(){n(),w(!0)},ref:t,src:"".concat(f).concat(k),title:"Editor iframe"})})]})})),Qr=n("./src/workspace/editorTypes.ts"),Xr={Editor:Yr,type:Qr.c},Zr={Editor:w.a,type:Qr.b},$r=(za={editorV1:Xr,editorV2:Zr},Object(H.a)(za,Xr.type,Xr),Object(H.a)(za,Zr.type,Zr),za),eo="datacamp.workspace.editorPreference.v2",to=Object(c.a)({editorVersion:Qr.a}),no=function(e){var t=e.editingAllowed,n=e.isScreenTooSmall,a=Object(m.useState)(),c=Object(r.a)(a,2),s=c[0],i=c[1],l=Object(qn.a)(to),u=Object(m.useCallback)((function(){M.d&&window.performance.mark(Object(M.b)("EDITOR-SWITCH"),{detail:{date:Date.now()}}),i((function(e){var t="iframeEditor"===(null===e||void 0===e?void 0:e.type)?Zr:Xr;return localStorage.setItem(eo,t.type),t}))}),[]);return Object(m.useEffect)((function(){i(function(e){var t=e.editingAllowed,n=(e.isScreenTooSmall,e.queryParams);if(!t)return Zr;if(f.b.isRight(n))switch(n.right.editorVersion){case"iframeEditor":case"dcStudioEditor":return $r[n.right.editorVersion];default:return Object(o.b)(n.right.editorVersion)}var a=localStorage.getItem(eo);return Qr.a.is(a)||"editorV1"===a||"editorV2"===a?$r[a]:Zr}({editingAllowed:t,isScreenTooSmall:n,queryParams:l}))}),[l,t,n]),{Editor:null===s||void 0===s?void 0:s.Editor,editorType:null===s||void 0===s?void 0:s.type,switchEditor:u}},ao=n("./src/nps/index.ts"),ro=n("./src/user/userHooks.ts"),oo=function(e){var t=e.workspace,n=Object(ro.c)();switch(null===n||void 0===n?void 0:n.status){case void 0:case"requested":case"refreshing":return null;case"failed":throw new Error("failed to load user");case"succeeded":return Object(E.b)(ao.a,{npsPage:{page:"workspace",workspaceId:t.id}});default:return Object(o.b)(n)}},co=n("../../node_modules/@datacamp/waffles/esm/icon/help-circle.js"),so=n("../../node_modules/@datacamp/waffles/esm/icon/book.js"),io=n("../../node_modules/@datacamp/waffles/esm/icon/keyboard.js"),lo=n("../../node_modules/@datacamp/waffles/esm/icon/chat.js"),uo=n("../../node_modules/@datacamp/waffles/esm/icon/exit.js"),bo=n("./src/accountSelector/DiamondIcon.tsx"),po=n("./src/BetaLogo.tsx"),fo=n("./src/publicProfile/Avatar.tsx"),mo=n("./src/editor/ActiveUserAvatar.tsx"),ho=function(e){var t=e.className,n=e.setActiveCellIndex,a=Object(mr.i)(),o=Object(mr.e)(),c=Object(m.useMemo)((function(){var e=Object(mr.a)({activeUsers:o,thisUserId:null===a||void 0===a?void 0:a.userId});return[e.slice(0,3),e.slice(3)]}),[o,a]),s=Object(r.a)(c,2),i=s[0],l=s[1];return Object(E.c)("div",{className:t,css:{alignItems:"center",alignSelf:"stretch",display:"flex",flexDirection:"row",gap:2,marginRight:12},children:[i.map((function(e){return null==e.name?null:Object(E.c)("div",{css:{alignItems:"center",alignSelf:"stretch",display:"flex",justifyContent:"center",position:"relative"},children:[Object(E.b)("button",{css:[_.k,{":hover":{backgroundColor:Object(D.d)(d.a.colors.navy,d.a.opacity.low)},alignItems:"center",alignSelf:"center",borderRadius:d.a.borderRadius.circle,display:"flex",flexDirection:"column",height:36,justifyContent:"center",width:36}],onClick:function(){null!=e.activeCellId&&null!=n&&n({cellId:e.activeCellId})},children:Object(E.b)(mo.a,{activeUser:e,css:{marginRight:0},dimensions:28})},"".concat(e.clientID," ").concat(e.name)),Object(E.b)("div",{css:{background:e.color,borderTopLeftRadius:d.a.borderRadius.medium,borderTopRightRadius:d.a.borderRadius.medium,bottom:0,height:2,left:11,position:"absolute",width:14}})]})})),l.length>0&&Object(E.b)(fo.a,{css:{backgroundColor:d.a.colors.white,color:d.a.colors.navySubtleTextOnLight,fontSize:d.a.fontSizes.small,fontWeight:d.a.fontWeights.bold,margin:0},dimensions:28,text:"+".concat(l.length),tooltip:l.map((function(e){return e.name})).join("\n")})]})},jo=n("./src/editor/useActiveCellIndex.ts"),go=n("./src/feedback/index.ts"),Oo=n("./src/navigation/NavbarIconButton.tsx"),wo=n("../../node_modules/@datacamp/waffles/esm/icon/locked.js"),vo=n("../../node_modules/@datacamp/waffles/esm/icon/group.js"),ko=n("../../node_modules/@datacamp/waffles/esm/icon/globe.js"),yo=n("./src/asyncData.ts"),xo=function(e){var t=e.Icon,n=e.loading,a=void 0!==n&&n,r=e.onClick,o=e.tooltipElement;return Object(E.c)(k.g,{appearance:"primary",ariaLabel:"open publish workspace panel",css:Object(H.a)({marginLeft:d.a.spacing.small},_.r.tablet,{padding:d.a.spacing.small,span:{display:"none"}}),dataAttributes:{trackid:Object(M.c)("open-publish-workspace-panel")},intent:"success",loading:a,onClick:r,size:"small",tooltipAppearance:"dark",tooltipPosition:"bottomRight",tooltipText:o,children:[Object(E.b)(t,{})," Share"]})},So=function(e){var t=e.onClick,n=function(e){var t=e.workspaceId,n=Object(m.useMemo)((function(){return{type:"workspace",workspaceId:t}}),[t]),a=Object(ue.a)(n),r=a.hasPublicAccess,o=a.refresh,c=a.roleAssignments,s=Object(U.c)(j.a);if(!Object(yo.b)(c))return{refresh:o,rolesSummary:"loading"};if(r)return{refresh:o,rolesSummary:"public"};var i=c.data.filter((function(e){return"public"!==e.subject.type})),l=i.filter((function(e){return"group"===e.subject.type})),u=l.map((function(e){var t;return Object(ia.b)(null===(t=s.find((function(t){return"group"!==e.subject.type?null:t.id===e.subject.groupId})))||void 0===t?void 0:t.name)})).filter((function(e){return null!=e})),d=i.filter((function(e){return"groupMember"===e.subject.type||"user"===e.subject.type}));return l.length>0&&d.length>0?{groupNames:u,refresh:o,rolesSummary:"individualsAndGroups",userCount:d.length}:l.length>0?{groupNames:u,refresh:o,rolesSummary:"groups"}:d.length>0?{refresh:o,rolesSummary:"individuals",userCount:d.length}:{refresh:o,rolesSummary:"private"}}({workspaceId:e.workspace.id}),a=function(){t(),n.refresh()};switch(null===n||void 0===n?void 0:n.rolesSummary){case"loading":return Object(E.b)(xo,{Icon:Ge.a,loading:!0,onClick:a,tooltipElement:Object(E.b)(ce.a,{css:{color:d.a.colors.white},children:"Loading"})});case"private":return Object(E.b)(xo,{Icon:wo.a,onClick:a,tooltipElement:Object(E.b)(ce.a,{css:{color:d.a.colors.white},children:"Private to only me"})});case"individuals":return Object(E.b)(xo,{Icon:vo.a,onClick:a,tooltipElement:Object(E.c)(ce.a,{css:{color:d.a.colors.white},children:["Shared with ",n.userCount," ",1===n.userCount?"person":"people"]})});case"groups":return Object(E.b)(xo,{Icon:vo.a,onClick:a,tooltipElement:Object(E.c)(ce.a,{css:{color:d.a.colors.white},children:["Shared with ",n.groupNames.join(",")]})});case"individualsAndGroups":return Object(E.b)(xo,{Icon:vo.a,onClick:a,tooltipElement:Object(E.c)(ce.a,{css:{color:d.a.colors.white},children:["Shared with ",n.userCount," ",1===n.userCount?"person":"people"," and"," ",n.groupNames.join(",")]})});case"public":return Object(E.b)(xo,{Icon:ko.a,onClick:a,tooltipElement:Object(E.b)(ce.a,{css:{color:d.a.colors.white},children:"Anyone with the link can access"})});default:return Object(o.b)(n)}},Co=function(e){var t=e.workspace,n=Object(U.b)(),a=Je({workspaceId:t.id}),r=a.retry,o=a.status,c=a.workspacePublicationStatus,s=null!=(null===c||void 0===c?void 0:c.lastSucceededPublication);return"loading"===o?null:"failed"===o?Object(E.b)(k.g,{appearance:"primary",ariaLabel:"retry to fetch publication",dataAttributes:{trackid:Object(M.c)("retry-fetch-publication")},intent:"success",onClick:r,size:"small",children:"Reload"}):Object(E.b)(So,{onClick:function(){n(Object(F.h)({published:s,workspace:t}))},workspace:t})},Io=n("../../node_modules/@datacamp/waffles/esm/icon/checkmark-circle.js"),To=n("../../node_modules/@datacamp/waffles-text/es/components/Small.js"),_o=function(){var e=Object(mr.g)(),t=e.saving,n=e.showAutoSaved,a=Object(U.c)(Kn.e),r=Object(hr.a)(),o=r?"saved"===a||"saving"===a:n||t;return Object(E.b)(To.a,{css:{alignItems:"center",color:d.a.colors.navySubtleTextOnLight,display:"flex",flexDirection:"row",gap:d.a.spacing.xsmall,marginRight:d.a.spacing.small,visibility:o?"visible":"hidden",whiteSpace:"nowrap",zIndex:2},children:(r?"saved"===a:n)?Object(E.c)(E.a,{children:[Object(E.b)(Io.a,{size:"small"}),"Work saved!"]}):Object(E.c)(E.a,{children:[Object(E.b)(Be.a,{}),"Autosaving\u2026"]})})},Eo=n("../../node_modules/@datacamp/waffles/esm/icon/random.js"),Po=Object(M.c)("switch-editor"),zo=function(e){var t=e.editorType,n=e.switchEditor,a=Object(m.useCallback)((function(){window.dcmfeSnowplow("trackStructEvent",{action:"switched-editor",category:"editing",label:"mfe-app-workspace",property:"iframeEditor"===t?"datacamp-studio":"jupyterlab"})}),[t]),r=Object(m.useCallback)((function(){n(),a()}),[n,a]);return Object(E.b)("div",{css:{display:"flex",height:0,justifyContent:"center",position:"absolute",width:"100%"},children:Object(E.b)(k.g,{css:[_.t,{"&:hover, &:focus, &:active":{":after":{border:"none"},div:{background:Object(D.d)(d.a.colors.navy,d.a.opacity.low),color:d.a.colors.blueDarkText,textDecoration:"underline"}},":before":{background:d.a.colors.white,bottom:5,content:'""',height:26,left:-8,pointerEvents:"none",position:"absolute",right:-8},background:d.a.colors.white,border:"none",borderRadius:13,bottom:-6,boxShadow:"0px 0px 1px ".concat(Object(D.d)(d.a.colors.navy,.2),", 0px 1px 4px rgba(61, 66, 81, 0.2)"),color:d.a.colors.blueDarkText,fontSize:d.a.fontSizes.small,height:26,lineHeight:d.a.lineHeights.relaxed,padding:"6px 10px 2px 10px"}],dataAttributes:{trackid:Po},onClick:r,children:Object(E.c)("div",{css:{alignItems:"center",borderRadius:d.a.borderRadius.medium,display:"flex",fontWeight:d.a.fontWeights.bold,gap:d.a.spacing.xsmall,padding:"0 2px",position:"relative",zIndex:2},children:[Object(E.b)(Eo.a,{css:{height:12,width:12}})," Switch editor"]})})})},Lo=n("../../node_modules/@datacamp/waffles/esm/icon/chevron-down.js"),Ao=n("../../node_modules/@datacamp/waffles-positioner/es/index.js"),Ro=n("../../node_modules/react-cool-onclickoutside/dist/index.esm.js"),Do=n("./src/dashboard/WorkspaceCardDropdown.tsx"),Wo=n("./src/useLinkClick.tsx"),Mo=function(e){var t=e.workspaceName;return Object(E.b)(b.a,{as:"h1",css:[Object(H.a)({cursor:"pointer",fontSize:d.a.fontSizes.large},_.r.smartphone,{fontSize:d.a.fontSizes.medium})],size:700,children:t})},No=function(e){var t=e.workspace,n=Object(m.useState)(!1),a=Object(r.a)(n,2),o=a[0],c=a[1],s=Object(m.useRef)(null),i=Object(m.useRef)(null),l=Object(U.c)(it.b),u=Je({workspaceId:t.id}).workspacePublicationStatus;Object(Ro.a)((function(){return c(!1)}),{refs:[s,i]});var b=Object(Ao.a)({isVisible:o,offset:3,position:t.name.length<20?"bottomLeft":"bottomRight",target:i}),p=null!=(null===u||void 0===u?void 0:u.lastSucceededPublication),f="LOGGED_IN"===l.status&&l.profile.id===t.creatorId;return Object(E.c)(E.a,{children:[Object(E.c)("div",{css:{":hover":{background:Object(D.d)(d.a.colors.navy,d.a.opacity.low)},alignItems:"center",borderRadius:d.a.borderRadius.medium,display:"flex",margin:"0 ".concat(d.a.spacing.xsmall," 0 -").concat(d.a.spacing.xsmall),maxWidth:"100%",overflow:"hidden",padding:"2px ".concat(d.a.spacing.xsmall),userSelect:"none"},onClick:function(){return c((function(e){return!e}))},ref:i,children:[Object(E.b)(Mo,{workspaceName:t.name}),Object(E.b)(Lo.a,{css:{boxSizing:"border-box",flexShrink:0,marginLeft:d.a.spacing.xsmall},size:"small"})]}),Object(E.b)("div",{onClick:Wo.a,ref:s,children:Object(E.b)(Do.a,{closeDropdown:function(){return c(!1)},css:[b,{zIndex:2}],isOwner:f,published:p,showEdit:!1,workspace:t})})]})},Fo=n("./src/workspace/useWorkspaceProfileInfo.tsx"),Uo=n("./src/redact.ts"),Jo=/[0-9a-f]{8}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{12}$/i,Bo=Object(p.c)([Object(H.a)({color:d.a.colors.navySubtleTextOnLight,flexShrink:0,fontFamily:d.a.fontFamilies.sansSerif,fontSize:d.a.fontSizes.large,paddingRight:0},_.r.smartphone,{fontSize:d.a.fontSizes.small,marginBottom:-2})]),Vo=function(e){var t=e.canEditSlug,n=e.workspaceOwnerSlug,a=Object(m.useMemo)((function(){return Jo.test(Object(ia.b)(n))}),[n]),o=Object(Uo.b)({spec:{text:!0},value:n}),c=Object(r.a)(o,2),s=c[0],i=c[1];return a&&t?Object(E.c)(E.a,{children:[Object(E.b)(k.g,{css:[Bo,{border:"none",padding:"0px ".concat(d.a.spacing.xsmall),span:{color:d.a.colors.navySubtleTextOnLight,fontSize:d.a.fontSizes.large,fontWeight:d.a.fontWeights.regular},textTransform:"unset"}],dataAttributes:s.dataAttributes,href:"".concat(Re.a.urls.datacamp,"/profile/account_settings"),target:"_blank",tooltipAppearance:"dark",tooltipPosition:"bottomLeft",tooltipText:"Edit your profile name",type:"link",children:i}),Object(E.c)(ce.a,{css:[Bo,{alignSelf:"center",padding:0}],children:[" ","/\xa0"]})]}):Object(E.c)(ce.a,Object(Y.a)(Object(Y.a)({css:Bo},s.attributes),{},{children:["".concat(i," /"),"\xa0"]}))},qo={svg:{height:14,width:14}},Ho=function(e){var t=e.text,n=Object(be.a)(),a=n.Tooltip,r=n.tooltipParentProps;return Object(E.c)(E.a,{children:[Object(E.c)("div",Object(Y.a)(Object(Y.a)({css:[{alignItems:"center",border:"1px solid ".concat(Object(D.d)(d.a.colors.navy,d.a.opacity.low)),borderRadius:d.a.borderRadius.medium,color:d.a.colors.navySubtleTextOnLight,cursor:"default",display:"flex",fontSize:d.a.fontSizes.small,lineHeight:d.a.lineHeights.relaxed,padding:"".concat(d.a.spacing.small," 10px")}]},r),{},{children:[Object(E.b)(bo.a,{css:{marginRight:d.a.spacing.xsmall},size:"small"}),t]})),Object(E.b)(a,{css:{fontSize:d.a.fontSizes.medium,lineHeight:d.a.lineHeights.relaxed,maxWidth:270,padding:d.a.spacing.xsmall,textTransform:"none",whiteSpace:"normal"},children:"Run code with 4x the speed and 4x the memory compared to the basic plan"})]})},Go=function(e){var t,n,a=e.className,r=e.editorType,c=e.showEditorSwitcher,s=void 0!==c&&c,i=e.startWorkspaceSessionState,l=e.switchEditor,u=void 0===l?pr.a:l,b=e.workspace,p=Object(U.b)(),f=Object(m.useContext)(v.a).editingEnabled,h=Object(Gn.b)().isScreenTooSmall,j=Object(jo.a)().setActiveCellIndexUsingId,g=Object(U.c)(it.b),O=Object(Bn.b)(),w=Object(Va.c)(),y=Object(m.useMemo)((function(){switch(i.status){case"loaded":switch(i.value.type){case"edit":return i.value.workspaceJwt;case"view":return;default:return Object(o.b)(i.value)}case"loading":case"uninitialized":case"error":return;default:return Object(o.b)(i)}}),[i]),x=Object(lt.a)(),S=x.closeModal,C=x.modalIsOpen,I=x.openModal,T=Object(st.a)({offset:8,position:"bottomRight"}),P=T.dropdownButtonRef,z=T.dropdownRef,L=T.dropdownStyle,A=T.isDropdownOpen,R=T.toggleDropdown,W=Object(Va.a)(),N=Object(Fo.a)(null!==b&&void 0!==b?b:null);if("LOGGED_IN"!==g.status)return null;var J=g.profile,B=J.avatar,V=J.slug,q=J.totalXp;return Object(E.c)("div",{className:a,css:{alignItems:"center",background:d.a.colors.white,boxShadow:"0px 0px 1px ".concat(Object(D.d)(d.a.colors.navy,.3),", 0px 1px 4px -1px rgba(61, 66, 81, 0.3)"),display:"flex",flexShrink:0,height:54,position:"relative",zIndex:3},children:[Object(E.b)(po.a,{}),Object(E.c)("div",{css:[Object(H.a)({alignItems:"center",display:"flex",flexDirection:"row",flexGrow:1,marginLeft:d.a.spacing.medium,minWidth:0,zIndex:3},_.r.smartphone,{alignItems:"flex-start",flexDirection:"column",marginLeft:d.a.spacing.small})],children:[null!=N&&Object(E.b)(Vo,{canEditSlug:Object(ia.b)(N.slug)===Object(ia.b)(V)&&"user"===(null===b||void 0===b?void 0:b.owner.type),workspaceOwnerSlug:N.slug}),null!=b&&Object(E.b)(No,{workspace:b}),!h&&Object(E.b)(_o,{})]}),s&&Object(E.b)(zo,{editorType:r,switchEditor:u}),Object(E.c)("div",{css:(t={"& > div > button > div":{height:28,width:28},"& > div:last-child":{"& > button":{":hover":{backgroundColor:Object(D.d)(d.a.colors.navy,d.a.opacity.low)},borderRadius:17,height:34},marginLeft:6}},Object(H.a)(t,"@media (max-width: ".concat(d.a.breakpoints.medium,")"),{paddingRight:12}),Object(H.a)(t,"alignItems","center"),Object(H.a)(t,"display","flex"),Object(H.a)(t,"flex","1 0 auto"),Object(H.a)(t,"height","100%"),Object(H.a)(t,"justifyContent","flex-end"),Object(H.a)(t,"paddingRight",16),Object(H.a)(t,"zIndex",1),t),children:[Object(E.b)(ho,{css:Object(H.a)({},_.r.tablet,{display:"none"}),setActiveCellIndex:j}),w?Object(E.b)(Ho,{text:W.has("workspace.teams")?"Teams":"Premium"}):Object(E.b)(k.g,{appearance:"inverted",css:{backgroundColor:"".concat(d.a.colors.purple," !important"),borderColor:d.a.colors.purple},href:"".concat(Re.a.urls.datacamp,"/pricing?tab=workspace"),tooltipPosition:"bottom",tooltipText:"Upgrade your Workspace subscription",type:"link",children:"Upgrade"}),null!=b&&O.includes("manage")&&Object(E.b)(Co,{startSessionJwt:y,workspace:b}),Object(E.c)("div",{css:(n={},Object(H.a)(n,_.r.tablet,{display:"none"}),Object(H.a)(n,"marginLeft",7),n),children:[Object(E.b)(k.g,{ariaLabel:"Open actions dropdown",css:Object(Y.a)(Object(Y.a)({},qo),Oo.b),onClick:function(){R()},ref:P,tooltipAppearance:"dark",tooltipPosition:"bottom",tooltipText:A?void 0:"Help & Feedback",children:Object(E.b)(co.a,{})}),Object(E.c)("div",{ref:z,children:[Object(E.b)(Dt.a,{css:L,elevation:3,children:Object(E.c)("ul",{css:[Object(Nt.a)(),{li:{button:{height:36,padding:"0 ".concat(d.a.spacing.medium)}},width:210}],children:[Object(E.b)(Mt.b,{Icon:so.a,action:{to:Re.a.urls.collabDocumentation,type:"href",useLinkClickOptions:{forceOpenInNewWindow:!0}},dataAttributes:{trackid:Object(M.c)("documentation-link")},externalLink:!0,iconProps:{css:{height:14,width:14}},children:"Documentation"}),f&&"dcStudioEditor"===r&&Object(E.b)(Mt.b,{Icon:io.a,action:{onClick:function(){return p(Object(F.i)({}))},type:"callback-old"},iconProps:{css:{height:14,width:14}},children:"Shortcuts (?)"}),null!=b&&Object(E.b)(Mt.b,{Icon:lo.a,action:{onClick:I,type:"callback-old"},dataAttributes:{trackid:Object(M.c)("provide-feedback-button")},iconProps:{css:{height:14,width:14}},children:"Give feedback"})]})}),null!=b&&Object(E.b)(go.a,{feedbackProps:{page:"dcStudioEditor"===r?"datacampStudio":"workspace",workspaceId:b.id},isOpen:C,onClose:S})]})]}),Object(E.b)(k.f,{mainAppUrl:Re.a.urls.datacamp,menuAccountSettingsTrackId:"user-account-menu-account-settings",menuLogOutTrackId:"user-account-menu-logout",menuMyProfileTrackId:"user-account-menu-profile",menuTriggerTrackId:"user-account-menu-trigger",userAvatarUrl:Object(ia.b)(B),userSlug:Object(ia.b)(V),userTotalXp:q})]}),Object(E.b)("div",{css:Object(H.a)({alignItems:"center",borderLeft:"".concat(d.a.borderWidth.thin," solid ").concat(d.a.colors.beigeMedium),display:"flex",height:"100%",justifyContent:"center",width:54},_.r.tablet,{display:"none"}),children:Object(E.b)(Oo.a,{ariaLabel:"Exit workspace",css:qo,href:"".concat(Re.a.urls.collabFrontend,"/workspace/dashboard"),icon:uo.a,target:"",tooltip:{appearance:"dark",position:"bottomRight"}})})]})},Ko=n("./src/workspace/WorkspaceSizeExceeded.tsx"),Yo=function(e){var t=e.Editor,n=e.activeView,a=e.onEditorLoaded,r=e.startWorkspaceSessionState,c=e.userState,s=e.workspace;Object(Dn.b)({workspaceOwner:s.owner}),function(e){var t=e.workspaceId,n=Fe(),a=Object(U.b)();Object(m.useEffect)((function(){"connected"===n.status&&n.socket.emit("joinWorkspaceRoom",{workspaceId:t})}),[n.socket,n.status,t]),Object(m.useEffect)((function(){var e=function(e){return a(Object(pe.d)(e))};return n.socket.on("workspaceUpdated",e),function(){n.socket.off("workspaceUpdated",e)}}),[t,n.socket,a])}({workspaceId:s.id}),function(e){var t=Object(ve.c)().status;Object(m.useEffect)((function(){"broken"===t.status&&Object(M.e)().increment("workspace_count_crashed_sessions",{language:e.language,reason:Xn(t.message)},1)}),[t,e.language])}(s),function(){var e=Object(ve.c)(),t=Object(m.useMemo)((function(){return Object(we.a)(e.outputs).reverse().find(Ua)}),[e.outputs]);Object(m.useEffect)((function(){null!=t&&Le.b.captureException(t.error.message)}),[t])}(),function(e){var t=Object(Kn.j)(),n=Object(U.c)(it.b),a=Object(m.useMemo)((function(){var e;return null!=t&&1===t.length&&""===(null===(e=t[0])||void 0===e?void 0:e.sharedModel.getSource())}),[t]);Object(m.useEffect)((function(){a&&Le.b.captureMessage("Workspace has empty notebook.",{level:Le.a.Warning,tags:{userId:"LOGGED_IN"===n.status&&n.profile.id,workspaceId:e.id}})}),[a,n,e.id])}(s);var i=Object(m.useRef)(null);return function(e){var t=e.activeView,n=e.editorRef;Object(m.useEffect)((function(){var e;switch(t){case"editor":null===(e=n.current)||void 0===e||e.focus();break;case"filebrowser":case"integrations":case"publish":break;default:Object(o.b)(t)}}),[t,n])}({activeView:n,editorRef:i}),Object(E.b)(t,{language:s.language,onEditorLoaded:a,ref:i,startWorkspaceSessionState:r,timetrackerId:s.timetrackerId,userProfile:c.profile,workspaceId:s.id,workspaceSize:s.size})},Qo=Object(c.a)({showNavBar:Object(s.c)(i.a,!0),showPublicationButton:Object(s.c)(i.a,!0)}),Xo=function(e){var t=e.Editor,n=e.editorType,a=e.onEditorLoaded,c=e.switchEditor,s=e.user,i=e.workspace,l=e.workspaceState,h=Object(U.b)();Object(m.useEffect)((function(){h(Object(rt.b)())}),[h]);var O=Object(U.c)(He.a),k=Object(m.useCallback)((function(e){return h(Object(rt.c)(e))}),[h]),y=Object(qn.a)(Qo),x=Object(m.useMemo)((function(){return f.c.pipe(y,f.b.getOrElse((function(){return{showNavBar:!0,showPublicationButton:!0}})))}),[y]),S=x.showNavBar,C=x.showPublicationButton,I=Object(m.useCallback)((function(){return h(Object(rt.c)("editor"))}),[h]),T=Object(U.c)(He.c);!function(e){var t=e.activeView,n=e.editorType,a=e.setActiveView;Object(m.useEffect)((function(){switch(n){case"iframeEditor":"filebrowser"===t&&a("editor");break;case"dcStudioEditor":case void 0:break;default:Object(o.b)(n)}}),[n,t,a])}({activeView:O,editorType:n,setActiveView:k}),function(e){var t=e.user,n=e.userGroups,a=e.workspace,c=Object(g.a)(),s=Object(r.a)(c,2)[1];Object(m.useEffect)((function(){if(null!=a)switch(a.owner.type){case"user":s({type:"personal"});break;case"group":var e=n.map((function(e){return e.id})).includes(a.owner.groupId);s(e?{groupId:a.owner.groupId,type:"group"}:{type:"personal"});break;default:Object(o.b)(a.owner)}}),[a,s,t,n])}({user:s,userGroups:Object(U.c)(j.a),workspace:i});var P=Object(U.c)(Ce.a),L=Object(m.useContext)(v.a),A=L.editingAllowed,R=L.hasEditPermission,D="dcStudioEditor"===n&&A,W=Object(Bn.b)(),M=R||W.includes("manage"),N=Object(m.useMemo)((function(){switch(l.status){case"error":return!0;case"loading":case"uninitialized":return!1;case"loaded":return"edit"!==l.value.type;default:return Object(o.b)(l)}}),[l]),F=Object(Gn.b)().isScreenTooSmall,J=function(e){var t=e.editorType,n=e.isScreenTooSmall,a=e.switchEditor,r=Object(ve.c)().jupyterFrontendUrl,o=null!=r&&!r.endsWith($e.b),c=Object(m.useRef)(!1);return Object(m.useEffect)((function(){"dcStudioEditor"!==t||!o||n||c.current||(c.current=!0,Object(z.b)({intent:"error",title:"This workspace cannot be opened in DataCamp\u2019s notebook editor because it doesn\u2019t contain a ".concat($e.b," file.")}),a())}),[o,t,n,a]),{doesntContainNotebookDotIpynbFile:o}}({editorType:n,isScreenTooSmall:F,switchEditor:c});if(J.doesntContainNotebookDotIpynbFile&&F)return Object(E.c)("div",{css:{alignItems:"center",display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",padding:d.a.spacing.large,textAlign:"center",width:"100%"},children:[Object(E.c)(b.a,{as:"h2",multiLine:!0,size:600,children:["This workspace cannot be opened in DataCamp\u2019s notebook editor because there is no ",$e.b," file."]}),Object(E.b)(u.a,{children:"You can access this workspace in JupyterLab on a non-mobile device."})]});var B=A&&!F,V="loaded"===l.status?l.value.workspaceJwt:void 0;return Object(E.c)("div",{css:_.p,children:[S&&Object(E.b)(Go,{editorType:n,showEditorSwitcher:B,startWorkspaceSessionState:l,switchEditor:c,workspace:null!==i&&void 0!==i?i:void 0}),Object(E.c)("div",{css:{display:"flex",flexDirection:"row",flexGrow:1,overflow:"auto"},children:[Object(E.b)(Wr,{activeView:O,setActiveView:k,shouldRestartBeforePublish:N,showEditorButton:"iframeEditor"===n,showFileBrowserButton:D,showIntegrationsButton:P,showPublicationButton:M&&C,showShortcutsButton:"dcStudioEditor"===n}),Object(E.c)("div",{css:{background:"dcStudioEditor"===n?d.a.colors.white:"initial",display:"flex",flexGrow:1,minWidth:0,position:"relative",zIndex:0},children:[Object(E.c)(Nr,{css:{zIndex:5},isOpen:T,onClose:I,width:_.e,withOverlay:"iframeEditor"===n||F,children:[null!=i&&Object(E.b)(Xe,{show:"publish"===O,startSessionJwt:V,workspace:i}),D&&null!=i&&Object(E.b)(w.b,{show:"filebrowser"===O,workspace:i}),P&&null!=i&&Object(E.b)(Fn,{show:"integrations"===O,workspace:i})]}),Object(E.b)(p.b,{styles:w.c}),Object(E.c)("div",{css:{display:"flex",flexDirection:"column",marginLeft:"dcStudioEditor"===n&&!F&&T?_.e:0,overflow:"hidden",transition:"margin-left 0.6s cubic-bezier(0.19, 1, 0.22, 1)",width:"100%"},children:["loaded"===l.status&&"view"===l.value.type&&"needsPaidSeat"===l.value.reason&&Object(E.b)(Jn,{}),R&&null!=i&&Object(Ko.d)(i.size)&&Object(E.b)(Ko.c,{workspaceId:i.id}),null==i||null==t?Object(E.b)(Hn.a,{}):Object(E.b)(Yo,{Editor:t,activeView:O,onEditorLoaded:a,startWorkspaceSessionState:l,userState:s,workspace:i})]})]})]}),null!=i&&Object(E.b)(oo,{workspace:i})]})};t.default=function(e){!function(){var e=Object(U.b)();Object(m.useEffect)((function(){Object(Ze.l)({dispatch:e,notebookModel:null}),e({type:"WORKSPACE_UPDATED",workspace:null})}),[e])}();var t=e.match.params.workspaceId,n=Object(U.c)(it.b),a=Object(Gn.b)().isScreenTooSmall,c=function(e){var t=e.workspaceId,n=Object(U.c)(it.b),a=Vr(),o=a.fetchWorkspace,c=a.workspaceState,s=Object(Va.d)(),i=Object(m.useCallback)((function(){return o(t)}),[t,o]),l=Object(m.useState)(),u=Object(r.a)(l,2),d=u[0],b=u[1];return Object(m.useEffect)((function(){"loaded"===c.status&&"LOGGED_IN"===n.status&&b((function(e){var t,n;return"edit"!==c.value.type||(null===e||void 0===e||null===(t=e.contentData)||void 0===t?void 0:t.id)===c.value.workspace.id&&(null===e||void 0===e?void 0:e.startSessionJwt)===c.value.workspaceJwt?e:{contentData:{editor:Jr.i[c.value.workspace.language],id:c.value.workspace.id},isPremium:s,sessionProfile:(n=c.value,{authenticationToken:n.authenticationToken,email:Object(Ur.b)("".concat(n.workspace.id,"@mux-session.com"))}),source:c.value.workspace.source,startSessionJwt:c.value.workspaceJwt,userJwt:c.value.userJwt,workspaceInitialized:c.value.workspace.initialized}}))}),[c,n,s]),Object(m.useEffect)((function(){("uninitialized"===c.status||"loaded"===c.status&&t!==c.value.workspace.id)&&i()}),[i,c,t]),{fetchWorkspace:i,multiplexerProps:t===(null===d||void 0===d?void 0:d.contentData.id)?d:void 0,workspaceState:c}}({workspaceId:t}),s=c.fetchWorkspace,i=c.multiplexerProps,u=c.workspaceState,d=Object(U.c)(Ce.c),b=Object(v.c)({workspace:d}).editingAllowed,p=no({editingAllowed:b,isScreenTooSmall:a}),f=p.Editor,j=p.editorType,g=p.switchEditor;!function(e){var t=e.fetchWorkspace,n=e.startWorkspaceSessionState,a=Object(Fr.a)("edit-workspace");Object(m.useEffect)((function(){"error"===n.status&&"needsToAcceptBetaTerms"===n.value&&"granted"===a&&t()}),[a,n,t])}({fetchWorkspace:s,startWorkspaceSessionState:u});var w=function(e,t){var n=Object(m.useState)(null),a=Object(r.a)(n,2),o=a[0],c=a[1],s=Object(m.useCallback)((function(){c(Date.now())}),[c]);return{onEditorLoaded:Object(m.useCallback)((function(){if(null!=o&&null!=e&&null!=t){var n=Date.now()-o,a=e.isNew?"new":"existing";Object(M.e)().observe("workspace_time_to_session_loaded",{editorType:t,language:e.language,version:2,workspaceState:a},n),Object(M.e)().observeDistribution("workspace_time_to_session_ready_for_editor_start",{editorType:t,language:e.language,workspaceState:a},n),c(null)}}),[o,e,t]),onSessionStarted:s}}(d,j),k=w.onEditorLoaded,y=w.onSessionStarted,x=Object(m.useCallback)((function(e){Le.b.captureMessage("Failed to get a session",{extra:{error:e},level:l.a.Info})}),[]),S=Object(m.useState)(void 0),C=Object(r.a)(S,2),I=C[0],T=C[1];if(Object(m.useEffect)((function(){"loaded"===u.status&&T(u.value.workspaceJwt)}),[u]),"error"===u.status)switch(u.value){case"workspaceNotFound":return Object(E.b)(h.a,{to:"/workspace/w/".concat(t)});case"notSignedIn":return Object(O.a)({page:"sign_in",queryParams:Vn.b.encode({type:"OpenWorkspace",workspaceId:t})}),null;case"needsToAcceptBetaTerms":return Object(E.b)("div",{css:_.p,children:Object(E.b)(Go,{editorType:j,startWorkspaceSessionState:u})});case"b2c2bBlockedFromUsingWorkspace":return Object(E.b)(Ve.a,{});case"blockedFromUsingWorkspace":return Object(E.b)(Ve.b,{});case"denyToAccessSomeIntegrations":return Object(E.b)(Ve.c,{});case"cannotStartWorkspace":case"noStartSessionJwt":case"failedToFetchGroupsError":return Object(E.b)(Ve.g,{onRetry:s});default:return Object(o.c)(u,Object(E.b)(Ve.g,{onRetry:s}))}return"LOGGED_IN"!==n.status?(Object(O.a)({queryParams:Vn.b.encode({type:"OpenWorkspace",workspaceId:t})}),null):"dcStudioEditor"!==j&&a?null==j?Object(E.b)(Hn.a,{}):Object(E.b)(Ve.e,{switchEditor:g}):null==I?Object(E.b)(Hn.a,{}):Object(E.b)(Ne,{children:Object(E.b)(Er,{editorType:j,multiplexerProps:i,onFailureToGetSession:x,onSessionStarted:y,workspace:d,workspaceId:t,workspaceJwt:I,children:Object(E.b)(qe.a,{fetchWorkspace:s,children:Object(E.b)(Xo,{Editor:f,editorType:j,onEditorLoaded:k,switchEditor:g,user:n,workspace:null!=d&&d.id===t?d:null,workspaceState:u})})})})}}}]);
//# sourceMappingURL=91.b726793e.chunk.js.map